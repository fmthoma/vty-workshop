<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Lens.Micro.Mtl</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Lens-Micro-Mtl.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Lens.Micro.Mtl.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">microlens-mtl-0.1.11.0: microlens support for Reader/Writer/State from mtl</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(C) 2013-2016 Edward Kmett 2015-2016 Artyom</td></tr><tr><th>License</th><td>BSD-style (see the file LICENSE)</td></tr><tr><th>Safe Haskell</th><td>Trustworthy</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Lens.Micro.Mtl</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Getting</a></li><li><a href="#g:2">Setting</a></li><li><a href="#g:3">Convenience</a></li><li><a href="#g:4">Specialised modifying operators</a></li><li><a href="#g:5">Setting with passthrough</a></li><li><a href="#g:6">Zooming</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc empty">&nbsp;</div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:view">view</a> :: <a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#t:MonadReader">MonadReader</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:Getting">Getting</a> a s a -&gt; m a</li><li class="src short"><a href="#v:preview">preview</a> :: <a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#t:MonadReader">MonadReader</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:Getting">Getting</a> (<a href="../base-4.9.1.0/Data-Monoid.html#t:First">First</a> a) s a -&gt; m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li class="src short"><a href="#v:use">use</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:Getting">Getting</a> a s a -&gt; m a</li><li class="src short"><a href="#v:preuse">preuse</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:Getting">Getting</a> (<a href="../base-4.9.1.0/Data-Monoid.html#t:First">First</a> a) s a -&gt; m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</li><li class="src short"><a href="#v:-37--61-">(%=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; (a -&gt; b) -&gt; m ()</li><li class="src short"><a href="#v:modifying">modifying</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; (a -&gt; b) -&gt; m ()</li><li class="src short"><a href="#v:.-61-">(.=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; b -&gt; m ()</li><li class="src short"><a href="#v:assign">assign</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; b -&gt; m ()</li><li class="src short"><a href="#v:-63--61-">(?=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> b) -&gt; b -&gt; m ()</li><li class="src short"><a href="#v:-60--126-">(&lt;~)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; m b -&gt; m ()</li><li class="src short"><a href="#v:-38--126-">(&amp;~)</a> :: s -&gt; <a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:State">State</a> s a -&gt; s</li><li class="src short"><a href="#v:-43--61-">(+=)</a> :: (<a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m, <a href="../base-4.9.1.0/Prelude.html#t:Num">Num</a> a) =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a a -&gt; a -&gt; m ()</li><li class="src short"><a href="#v:-45--61-">(-=)</a> :: (<a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m, <a href="../base-4.9.1.0/Prelude.html#t:Num">Num</a> a) =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a a -&gt; a -&gt; m ()</li><li class="src short"><a href="#v:-42--61-">(*=)</a> :: (<a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m, <a href="../base-4.9.1.0/Prelude.html#t:Num">Num</a> a) =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a a -&gt; a -&gt; m ()</li><li class="src short"><a href="#v:-47--47--61-">(//=)</a> :: (<a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m, <a href="../base-4.9.1.0/Prelude.html#t:Fractional">Fractional</a> a) =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a a -&gt; a -&gt; m ()</li><li class="src short"><a href="#v:-60--37--61-">(&lt;%=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> b) s s a b -&gt; (a -&gt; b) -&gt; m b</li><li class="src short"><a href="#v:-60-.-61-">(&lt;.=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> b) s s a b -&gt; b -&gt; m b</li><li class="src short"><a href="#v:-60--63--61-">(&lt;?=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> b) s s a (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> b) -&gt; b -&gt; m b</li><li class="src short"><a href="#v:-60--60--37--61-">(&lt;&lt;%=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> a) s s a b -&gt; (a -&gt; b) -&gt; m a</li><li class="src short"><a href="#v:-60--60-.-61-">(&lt;&lt;.=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> a) s s a b -&gt; b -&gt; m a</li><li class="src short"><a href="#v:zoom">zoom</a> :: <a href="Lens-Micro-Mtl-Internal.html#t:Zoom">Zoom</a> m n s t =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike-39-">LensLike'</a> (<a href="Lens-Micro-Mtl-Internal.html#t:Zoomed">Zoomed</a> m c) t s -&gt; m c -&gt; n c</li><li class="src short"><a href="#v:magnify">magnify</a> :: <a href="Lens-Micro-Mtl-Internal.html#t:Magnify">Magnify</a> m n b a =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike-39-">LensLike'</a> (<a href="Lens-Micro-Mtl-Internal.html#t:Magnified">Magnified</a> m c) a b -&gt; m c -&gt; n c</li></ul></div><div id="interface"><h1 id="g:1">Getting</h1><div class="top"><p class="src"><a id="v:view" class="def">view</a> :: <a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#t:MonadReader">MonadReader</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:Getting">Getting</a> a s a -&gt; m a <a href="src/Lens.Micro.Mtl.html#view" class="link">Source</a> <a href="#v:view" class="selflink">#</a></p><div class="doc"><p><code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> is a synonym for (<code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-94-.">^.</a></code>), generalised for <code><a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#t:MonadReader">MonadReader</a></code> (we are able to use it instead of (<code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-94-.">^.</a></code>) since functions are instances of the <code><a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#t:MonadReader">MonadReader</a></code> class):</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>view _1 (1, 2)
</code></strong>1
</pre><p>When you're using <code><a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a></code> for config and your config type has lenses generated for it, most of the time you'll be using <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> instead of <code><a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#v:asks">asks</a></code>:</p><pre>doSomething :: (<code><a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#t:MonadReader">MonadReader</a></code> Config m) =&gt; m Int
doSomething = do
  thingy        &lt;- <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> setting1  -- same as &#8220;<code><a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#v:asks">asks</a></code> (<code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-94-.">^.</a></code> setting1)&#8221;
  anotherThingy &lt;- <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> setting2
  ...
</pre></div></div><div class="top"><p class="src"><a id="v:preview" class="def">preview</a> :: <a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#t:MonadReader">MonadReader</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:Getting">Getting</a> (<a href="../base-4.9.1.0/Data-Monoid.html#t:First">First</a> a) s a -&gt; m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> a) <a href="src/Lens.Micro.Mtl.html#preview" class="link">Source</a> <a href="#v:preview" class="selflink">#</a></p><div class="doc"><p><code><a href="Lens-Micro-Mtl.html#v:preview">preview</a></code> is a synonym for (<code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-94--63-">^?</a></code>), generalised for <code><a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#t:MonadReader">MonadReader</a></code> (just like <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code>, which is a synonym for (<code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-94-.">^.</a></code>)).</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>preview each [1..5]
</code></strong>Just 1
</pre></div></div><div class="top"><p class="src"><a id="v:use" class="def">use</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:Getting">Getting</a> a s a -&gt; m a <a href="src/Lens.Micro.Mtl.html#use" class="link">Source</a> <a href="#v:use" class="selflink">#</a></p><div class="doc"><p><code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> is (<code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-94-.">^.</a></code>) (or <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code>) which implicitly operates on the state; for instance, if your state is a record containing a field <code>foo</code>, you can write</p><pre>x &lt;- <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> foo
</pre><p>to extract <code>foo</code> from the state. In other words, <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> is the same as <code><a href="../mtl-2.2.1/Control-Monad-State-Class.html#v:gets">gets</a></code>, but for getters instead of functions.</p><p>The implementation of <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> is straightforward:</p><pre><code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> l = <code><a href="../mtl-2.2.1/Control-Monad-State-Class.html#v:gets">gets</a></code> (<code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> l)
</pre><p>If you need to extract something with a fold or traversal, you need <code><a href="Lens-Micro-Mtl.html#v:preuse">preuse</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:preuse" class="def">preuse</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:Getting">Getting</a> (<a href="../base-4.9.1.0/Data-Monoid.html#t:First">First</a> a) s a -&gt; m (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> a) <a href="src/Lens.Micro.Mtl.html#preuse" class="link">Source</a> <a href="#v:preuse" class="selflink">#</a></p><div class="doc"><p><code><a href="Lens-Micro-Mtl.html#v:preuse">preuse</a></code> is (<code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-94--63-">^?</a></code>) (or <code><a href="Lens-Micro-Mtl.html#v:preview">preview</a></code>) which implicitly operates on the state &#8211; it takes the state and applies a traversal (or fold) to it to extract the 1st element the traversal points at.</p><pre><code><a href="Lens-Micro-Mtl.html#v:preuse">preuse</a></code> l = <code><a href="../mtl-2.2.1/Control-Monad-State-Class.html#v:gets">gets</a></code> (<code><a href="Lens-Micro-Mtl.html#v:preview">preview</a></code> l)
</pre></div></div><h1 id="g:2">Setting</h1><div class="top"><p class="src"><a id="v:-37--61-" class="def">(%=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; (a -&gt; b) -&gt; m () <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%25%3D" class="link">Source</a> <a href="#v:-37--61-" class="selflink">#</a></p><div class="doc"><p>Modify state by applying a function to a part of the state. An example:</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>execState (do _1 %= (+1); _2 %= reverse) (1,&quot;hello&quot;)
</code></strong>(2,&quot;olleh&quot;)
</pre><p>Implementation:</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-37--61-">%=</a></code> f = <code><a href="../mtl-2.2.1/Control-Monad-State-Class.html#v:modify">modify</a></code> (l <code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-37--126-">%~</a></code> f)
</pre><p>If you also want to get the value before/after the modification, use (<code><a href="Lens-Micro-Mtl.html#v:-60--60--37--61-">&lt;&lt;%=</a></code>)/(<code><a href="Lens-Micro-Mtl.html#v:-60--37--61-">&lt;%=</a></code>).</p><p>There are a few specialised versions of (<code><a href="Lens-Micro-Mtl.html#v:-37--61-">%=</a></code>) which mimic C operators:</p><ul><li>(<code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code>) for addition</li><li>(<code><a href="Lens-Micro-Mtl.html#v:-45--61-">-=</a></code>) for substraction</li><li>(<code><a href="Lens-Micro-Mtl.html#v:-42--61-">*=</a></code>) for multiplication</li><li>(<code><a href="Lens-Micro-Mtl.html#v:-47--47--61-">//=</a></code>) for division</li></ul></div></div><div class="top"><p class="src"><a id="v:modifying" class="def">modifying</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; (a -&gt; b) -&gt; m () <a href="src/Lens.Micro.Mtl.html#modifying" class="link">Source</a> <a href="#v:modifying" class="selflink">#</a></p><div class="doc"><p>A synonym for (<code><a href="Lens-Micro-Mtl.html#v:-37--61-">%=</a></code>).</p></div></div><div class="top"><p class="src"><a id="v:.-61-" class="def">(.=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; b -&gt; m () <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#.%3D" class="link">Source</a> <a href="#v:.-61-" class="selflink">#</a></p><div class="doc"><p>Modify state by &#8220;assigning&#8221; a value to a part of the state.</p><p>This is merely (<code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:.-126-">.~</a></code>) which works in <code><a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a></code>:</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code> x = <code><a href="../mtl-2.2.1/Control-Monad-State-Class.html#v:modify">modify</a></code> (l <code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:.-126-">.~</a></code> x)
</pre><p>If you also want to know the value that was replaced by (<code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code>), use (<code><a href="Lens-Micro-Mtl.html#v:-60--60-.-61-">&lt;&lt;.=</a></code>).</p></div></div><div class="top"><p class="src"><a id="v:assign" class="def">assign</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; b -&gt; m () <a href="src/Lens.Micro.Mtl.html#assign" class="link">Source</a> <a href="#v:assign" class="selflink">#</a></p><div class="doc"><p>A synonym for (<code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code>).</p></div></div><div class="top"><p class="src"><a id="v:-63--61-" class="def">(?=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> b) -&gt; b -&gt; m () <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%3F%3D" class="link">Source</a> <a href="#v:-63--61-" class="selflink">#</a></p><div class="doc"><p>(<code><a href="Lens-Micro-Mtl.html#v:-63--61-">?=</a></code>) is a version of (<code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code>) that wraps the value into <code><a href="../base-4.9.1.0/Data-Maybe.html#v:Just">Just</a></code> before setting.</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-63--61-">?=</a></code> b = l <code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code> Just b
</pre><p>It can be useful in combination with <code><a href="../microlens-0.4.8.1/Lens-Micro-Internal.html#v:at">at</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:-60--126-" class="def">(&lt;~)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a b -&gt; m b -&gt; m () <span class="fixity">infixr 2</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%3C~" class="link">Source</a> <a href="#v:-60--126-" class="selflink">#</a></p><div class="doc"><p>(<code><a href="Lens-Micro-Mtl.html#v:-60--126-">&lt;~</a></code>) is a version of (<code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code>) that takes a monadic value (and then executes it and assigns the result to the lens).</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-60--126-">&lt;~</a></code> mb = do
  b &lt;- mb
  l <code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code> b
</pre></div></div><h1 id="g:3">Convenience</h1><div class="top"><p class="src"><a id="v:-38--126-" class="def">(&amp;~)</a> :: s -&gt; <a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:State">State</a> s a -&gt; s <span class="fixity">infixl 1</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%26~" class="link">Source</a> <a href="#v:-38--126-" class="selflink">#</a></p><div class="doc"><p>This can be used to chain lens operations using <code>op=</code> syntax
rather than <code>op~</code> syntax for simple non-type-changing cases.
&gt;&gt;&gt; (10,20) &amp; _1 .~ 30 &amp; _2 .~ 40
(30,40)</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>(10,20) &amp;~ do _1 .= 30; _2 .= 40
</code></strong>(30,40)
</pre><p>This does not support type-changing assignment, <em>e.g.</em></p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>(10,20) &amp; _1 .~ &quot;hello&quot;
</code></strong>(&quot;hello&quot;,20)
</pre></div></div><h1 id="g:4">Specialised modifying operators</h1><div class="doc"><p>The following operators mimic well-known C operators (<code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code>, <code><a href="Lens-Micro-Mtl.html#v:-45--61-">-=</a></code>, etc). (<code><a href="Lens-Micro-Mtl.html#v:-47--47--61-">//=</a></code>) stands for division.</p><p>They're implemented like this:</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code> x = l <code><a href="Lens-Micro-Mtl.html#v:-37--61-">%=</a></code> (+x)
l <code><a href="Lens-Micro-Mtl.html#v:-45--61-">-=</a></code> x = l <code><a href="Lens-Micro-Mtl.html#v:-37--61-">%=</a></code> (<code><a href="../base-4.9.1.0/Prelude.html#v:subtract">subtract</a></code> x)
...
</pre></div><div class="top"><p class="src"><a id="v:-43--61-" class="def">(+=)</a> :: (<a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m, <a href="../base-4.9.1.0/Prelude.html#t:Num">Num</a> a) =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a a -&gt; a -&gt; m () <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%2B%3D" class="link">Source</a> <a href="#v:-43--61-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:-45--61-" class="def">(-=)</a> :: (<a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m, <a href="../base-4.9.1.0/Prelude.html#t:Num">Num</a> a) =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a a -&gt; a -&gt; m () <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#-%3D" class="link">Source</a> <a href="#v:-45--61-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:-42--61-" class="def">(*=)</a> :: (<a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m, <a href="../base-4.9.1.0/Prelude.html#t:Num">Num</a> a) =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a a -&gt; a -&gt; m () <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%2A%3D" class="link">Source</a> <a href="#v:-42--61-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:-47--47--61-" class="def">(//=)</a> :: (<a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m, <a href="../base-4.9.1.0/Prelude.html#t:Fractional">Fractional</a> a) =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:ASetter">ASetter</a> s s a a -&gt; a -&gt; m () <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%2F%2F%3D" class="link">Source</a> <a href="#v:-47--47--61-" class="selflink">#</a></p></div><h1 id="g:5">Setting with passthrough</h1><div class="top"><p class="src"><a id="v:-60--37--61-" class="def">(&lt;%=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> b) s s a b -&gt; (a -&gt; b) -&gt; m b <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%3C%25%3D" class="link">Source</a> <a href="#v:-60--37--61-" class="selflink">#</a></p><div class="doc"><p>Modify state and return the modified (new) value.</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-60--37--61-">&lt;%=</a></code> f = do
  l <code><a href="Lens-Micro-Mtl.html#v:-37--61-">%=</a></code> f
  <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> l
</pre></div></div><div class="top"><p class="src"><a id="v:-60-.-61-" class="def">(&lt;.=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> b) s s a b -&gt; b -&gt; m b <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%3C.%3D" class="link">Source</a> <a href="#v:-60-.-61-" class="selflink">#</a></p><div class="doc"><p>Set state and return new value.</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-60-.-61-">&lt;.=</a></code> b = do
  l <code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code> b
  return b
</pre></div></div><div class="top"><p class="src"><a id="v:-60--63--61-" class="def">(&lt;?=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> b) s s a (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> b) -&gt; b -&gt; m b <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%3C%3F%3D" class="link">Source</a> <a href="#v:-60--63--61-" class="selflink">#</a></p><div class="doc"><p>(<code><a href="Lens-Micro-Mtl.html#v:-60--63--61-">&lt;?=</a></code>) is a version of (<code><a href="Lens-Micro-Mtl.html#v:-60-.-61-">&lt;.=</a></code>) that wraps the value into <code><a href="../base-4.9.1.0/Data-Maybe.html#v:Just">Just</a></code> before setting.</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-60--63--61-">&lt;?=</a></code> b = do
  l <code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code> Just b
  <code><a href="../base-4.9.1.0/Control-Monad.html#v:return">return</a></code> b
</pre><p>It can be useful in combination with <code><a href="../microlens-0.4.8.1/Lens-Micro-Internal.html#v:at">at</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:-60--60--37--61-" class="def">(&lt;&lt;%=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> a) s s a b -&gt; (a -&gt; b) -&gt; m a <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%3C%3C%25%3D" class="link">Source</a> <a href="#v:-60--60--37--61-" class="selflink">#</a></p><div class="doc"><p>Modify state and return the old value (i.e. as it was before the modificaton).</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-60--60--37--61-">&lt;&lt;%=</a></code> f = do
  old &lt;- <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> l
  l <code><a href="Lens-Micro-Mtl.html#v:-37--61-">%=</a></code> f
  return old
</pre></div></div><div class="top"><p class="src"><a id="v:-60--60-.-61-" class="def">(&lt;&lt;.=)</a> :: <a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a> s m =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike">LensLike</a> (<a href="../ghc-prim-0.5.0.0/GHC-Tuple.html#t:-40--44--41-">(,)</a> a) s s a b -&gt; b -&gt; m a <span class="fixity">infix 4</span><span class="rightedge"></span> <a href="src/Lens.Micro.Mtl.html#%3C%3C.%3D" class="link">Source</a> <a href="#v:-60--60-.-61-" class="selflink">#</a></p><div class="doc"><p>Set state and return the old value.</p><pre>l <code><a href="Lens-Micro-Mtl.html#v:-60--60-.-61-">&lt;&lt;.=</a></code> b = do
  old &lt;- <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> l
  l <code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code> b
  return old
</pre></div></div><h1 id="g:6">Zooming</h1><div class="top"><p class="src"><a id="v:zoom" class="def">zoom</a> :: <a href="Lens-Micro-Mtl-Internal.html#t:Zoom">Zoom</a> m n s t =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike-39-">LensLike'</a> (<a href="Lens-Micro-Mtl-Internal.html#t:Zoomed">Zoomed</a> m c) t s -&gt; m c -&gt; n c <a href="src/Lens.Micro.Mtl.Internal.html#zoom" class="link">Source</a> <a href="#v:zoom" class="selflink">#</a></p><div class="doc"><p>When you're in a state monad, this function lets you operate on a part of your state. For instance, if your state was a record containing a <code>position</code> field, after zooming <code>position</code> would become your whole state (and when you modify it, the bigger structure would be modified as well).</p><p>(Your <code><a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:State">State</a></code> / <code><a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:StateT">StateT</a></code> or <code><a href="../mtl-2.2.1/Control-Monad-RWS-Lazy.html#t:RWS">RWS</a></code> / <code><a href="../mtl-2.2.1/Control-Monad-RWS-Lazy.html#t:RWST">RWST</a></code> can be anywhere in the stack, but you can't use <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code> with arbitrary <code><a href="../mtl-2.2.1/Control-Monad-State-Class.html#t:MonadState">MonadState</a></code> because it doesn't provide any methods to change the type of the state. See <a href="https://github.com/ekmett/lens/issues/316">this issue</a> for details.)</p><p>For the sake of the example, let's define some types first:</p><pre>data Position = Position {
  _x, _y :: Int }

data Player = Player {
  _position :: Position,
  ... }

data Game = Game {
  _player :: Player,
  _obstacles :: [Position],
  ... }

concat &lt;$&gt; mapM makeLenses [''Position, ''Player, ''Game]
</pre><p>Now, here's an action that moves the player north-east:</p><pre>moveNE :: <code><a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:State">State</a></code> Game ()
moveNE = do
  player.position.x <code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code> 1
  player.position.y <code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code> 1
</pre><p>With <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code>, you can use <code>player.position</code> to focus just on a part of the state:</p><pre>moveNE :: <code><a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:State">State</a></code> Game ()
moveNE = do
  <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code> (player.position) $ do
    x <code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code> 1
    y <code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code> 1
</pre><p>You can just as well use it for retrieving things out of the state:</p><pre>getCoords :: <code><a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:State">State</a></code> Game (Int, Int)
getCoords = <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code> (player.position) ((,) <code><a href="../base-4.9.1.0/Data-Functor.html#v:-60--36--62-">&lt;$&gt;</a></code> <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> x <code><a href="../base-4.9.1.0/Control-Applicative.html#v:-60--42--62-">&lt;*&gt;</a></code> <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> y)
</pre><p>Or more explicitly:</p><pre>getCoords = <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code> (player.position) $ do
  x' &lt;- <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> x
  y' &lt;- <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> y
  return (x', y')
</pre><p>When you pass a traversal to <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code>, it'll work as a loop. For instance, here we move all obstacles:</p><pre>moveObstaclesNE :: <code><a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:State">State</a></code> Game ()
moveObstaclesNE = do
  <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code> (obstacles.<code><a href="../microlens-0.4.8.1/Lens-Micro-Internal.html#v:each">each</a></code>) $ do
    x <code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code> 1
    y <code><a href="Lens-Micro-Mtl.html#v:-43--61-">+=</a></code> 1
</pre><p>If the action returns a result, all results would be combined with <code>&lt;&gt;</code> &#8211; the same way they're combined when <code><a href="../microlens-0.4.8.1/Lens-Micro.html#v:-94-.">^.</a></code> is passed a traversal. In this example, <code>moveObstaclesNE</code> returns a list of old coordinates of obstacles in addition to moving them:</p><pre>moveObstaclesNE = do
  xys &lt;- <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code> (obstacles.<code><a href="../microlens-0.4.8.1/Lens-Micro-Internal.html#v:each">each</a></code>) $ do
    -- Get old coordinates.
    x' &lt;- <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> x
    y' &lt;- <code><a href="Lens-Micro-Mtl.html#v:use">use</a></code> y
    -- Update them.
    x <code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code> x' + 1
    y <code><a href="Lens-Micro-Mtl.html#v:.-61-">.=</a></code> y' + 1
    -- Return a single-element list with old coordinates.
    return [(x', y')]
  ...
</pre><p>Finally, you might need to write your own instances of <code><a href="Lens-Micro-Mtl-Internal.html#t:Zoom">Zoom</a></code> if you use <code>newtype</code>d transformers in your monad stack. This can be done as follows:</p><pre>import <a href="Lens-Micro-Mtl-Internal.html">Lens.Micro.Mtl.Internal</a>

type instance <code><a href="Lens-Micro-Mtl-Internal.html#t:Zoomed">Zoomed</a></code> (MyStateT s m) = <code><a href="Lens-Micro-Mtl-Internal.html#t:Zoomed">Zoomed</a></code> (StateT s m)

instance Monad m =&gt; <code><a href="Lens-Micro-Mtl-Internal.html#t:Zoom">Zoom</a></code> (MyStateT s m) (MyStateT t m) s t where
    <code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code> l (MyStateT m) = MyStateT (<code><a href="Lens-Micro-Mtl.html#v:zoom">zoom</a></code> l m)
</pre></div></div><div class="top"><p class="src"><a id="v:magnify" class="def">magnify</a> :: <a href="Lens-Micro-Mtl-Internal.html#t:Magnify">Magnify</a> m n b a =&gt; <a href="../microlens-0.4.8.1/Lens-Micro-Type.html#t:LensLike-39-">LensLike'</a> (<a href="Lens-Micro-Mtl-Internal.html#t:Magnified">Magnified</a> m c) a b -&gt; m c -&gt; n c <a href="src/Lens.Micro.Mtl.Internal.html#magnify" class="link">Source</a> <a href="#v:magnify" class="selflink">#</a></p><div class="doc"><p>This is an equivalent of <code><a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#v:local">local</a></code> which lets you apply a getter to your environment instead of merely applying a function (and it also lets you change the type of the environment).</p><pre><code><a href="../mtl-2.2.1/Control-Monad-Reader-Class.html#v:local">local</a></code>   :: (r -&gt; r)   -&gt; <code><a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a></code> r a -&gt; <code><a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a></code> r a
<code><a href="Lens-Micro-Mtl.html#v:magnify">magnify</a></code> :: Getter r x -&gt; <code><a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a></code> x a -&gt; <code><a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a></code> r a
</pre><p><code><a href="Lens-Micro-Mtl.html#v:magnify">magnify</a></code> works with <code><a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a></code> / <code><a href="../mtl-2.2.1/Control-Monad-Reader.html#t:ReaderT">ReaderT</a></code>, <code><a href="../mtl-2.2.1/Control-Monad-RWS-Lazy.html#t:RWS">RWS</a></code> / <code><a href="../mtl-2.2.1/Control-Monad-RWS-Lazy.html#t:RWST">RWST</a></code>, and <code>(-&gt;)</code>.</p><p>Here's an example of <code><a href="Lens-Micro-Mtl.html#v:magnify">magnify</a></code> being used to work with a part of a bigger config. First, the types:</p><pre>data URL = URL {
  _protocol :: Maybe String,
  _path :: String }

data Config = Config {
  _base :: URL,
  ... }

makeLenses ''URL
makeLenses ''Config
</pre><p>Now, let's define a function which returns the base url:</p><pre>getBase :: <code><a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a></code> Config String
getBase = do
  protocol &lt;- <code><a href="../base-4.9.1.0/Data-Maybe.html#v:fromMaybe">fromMaybe</a></code> &quot;https&quot; <code><a href="../base-4.9.1.0/Data-Functor.html#v:-60--36--62-">&lt;$&gt;</a></code> <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> (base.protocol)
  path     &lt;- <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> (base.path)
  return (protocol ++ path)
</pre><p>With <code><a href="Lens-Micro-Mtl.html#v:magnify">magnify</a></code>, we can factor out <code>base</code>:</p><pre>getBase = <code><a href="Lens-Micro-Mtl.html#v:magnify">magnify</a></code> base $ do
  protocol &lt;- <code><a href="../base-4.9.1.0/Data-Maybe.html#v:fromMaybe">fromMaybe</a></code> &quot;https&quot; <code><a href="../base-4.9.1.0/Data-Functor.html#v:-60--36--62-">&lt;$&gt;</a></code> <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> protocol
  path     &lt;- <code><a href="Lens-Micro-Mtl.html#v:view">view</a></code> path
  return (protocol ++ path)
</pre><p>This concludes the example.</p><p>Finally, you should know writing instances of <code><a href="Lens-Micro-Mtl-Internal.html#t:Magnify">Magnify</a></code> for your own types can be done as follows:</p><pre>import <a href="Lens-Micro-Mtl-Internal.html">Lens.Micro.Mtl.Internal</a>

type instance <code><a href="Lens-Micro-Mtl-Internal.html#t:Magnified">Magnified</a></code> (MyReaderT r m) = <code><a href="Lens-Micro-Mtl-Internal.html#t:Magnified">Magnified</a></code> (ReaderT r m)

instance Monad m =&gt; <code><a href="Lens-Micro-Mtl-Internal.html#t:Magnify">Magnify</a></code> (MyReaderT r m) (MyReaderT t m) r t where
    <code><a href="Lens-Micro-Mtl.html#v:magnify">magnify</a></code> l (MyReaderT m) = MyReaderT (<code><a href="Lens-Micro-Mtl.html#v:magnify">magnify</a></code> l m)
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>