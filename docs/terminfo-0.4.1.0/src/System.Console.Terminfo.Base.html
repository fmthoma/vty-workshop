<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, DeriveDataTypeable, FlexibleInstances, ScopedTypeVariables #-}</span><span>
</span><a name="line-2"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 703</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><a name="line-4"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- Maintainer  : judah.jacobson@gmail.com</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Stability   : experimental</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Portability : portable (FFI)</span><span>
</span><a name="line-9"></a><span class="hs-comment">--</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- This module provides a low-level interface to the C functions of the </span><span>
</span><a name="line-11"></a><span class="hs-comment">-- terminfo library. </span><span>
</span><a name="line-12"></a><span class="hs-comment">-- </span><span>
</span><a name="line-13"></a><span class="hs-comment">-- NOTE: Since this library is built on top of the curses interface, it is not thread-safe.</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Console</span><span class="hs-operator">.</span><span class="hs-identifier">Terminfo</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span><span class="hs-special">(</span><span>
</span><a name="line-16"></a><span>                            </span><span class="hs-comment">-- *  Initialization</span><span>
</span><a name="line-17"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#setupTerm"><span class="hs-identifier hs-var">setupTerm</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#setupTermFromEnv"><span class="hs-identifier hs-var">setupTermFromEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-type">SetupTermError</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>                            </span><span class="hs-comment">-- * Capabilities</span><span>
</span><a name="line-22"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#getCapability"><span class="hs-identifier hs-var">getCapability</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#tiGetFlag"><span class="hs-identifier hs-var">tiGetFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#tiGuardFlag"><span class="hs-identifier hs-var">tiGuardFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#tiGetNum"><span class="hs-identifier hs-var">tiGetNum</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier hs-var">tiGetStr</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>                            </span><span class="hs-comment">-- * Output</span><span>
</span><a name="line-29"></a><span>                            </span><span class="hs-comment">-- $outputdoc</span><span>
</span><a name="line-30"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#tiGetOutput1"><span class="hs-identifier hs-var">tiGetOutput1</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#TermStr"><span class="hs-identifier hs-type">TermStr</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>                            </span><span class="hs-comment">-- ** TermOutput</span><span>
</span><a name="line-34"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#runTermOutput"><span class="hs-identifier hs-var">runTermOutput</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#hRunTermOutput"><span class="hs-identifier hs-var">hRunTermOutput</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#termText"><span class="hs-identifier hs-var">termText</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#tiGetOutput"><span class="hs-identifier hs-var">tiGetOutput</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>                            </span><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>                            </span><span class="hs-comment">-- ** Monoid functions</span><span>
</span><a name="line-41"></a><span>                            </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>                            </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#%3C%23%3E"><span class="hs-operator hs-var">&lt;#&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>                            </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-48"></a><span class="hs-cpp">#if MIN_VERSION_base(4,9,0)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span><span>
</span><a name="line-50"></a><span class="hs-cpp">#elif !MIN_VERSION_base(4,8,0)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-52"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">C</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">ForeignPtr</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Ptr</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Marshal</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span class="hs-operator">.</span><span class="hs-identifier">Storable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">peek</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">Environment</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getEnv</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Unsafe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafePerformIO</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">data</span><span> </span><a name="TERMINAL"><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier">TERMINAL</span></a></a><span>
</span><a name="line-66"></a><span class="hs-keyword">newtype</span><span> </span><a name="Terminal"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier">Terminal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Terminal"><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier">Terminal</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ForeignPtr</span><span> </span><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-type">TERMINAL</span></a><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-comment">-- Use &quot;unsafe&quot; to make set_curterm faster since it's called quite a bit.</span><span>
</span><a name="line-69"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">unsafe</span><span> </span><span class="hs-identifier">set_curterm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-type">TERMINAL</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-type">TERMINAL</span></a><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-string">&quot;&amp;&quot;</span><span> </span><span class="hs-identifier">del_curterm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FunPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><a href="System.Console.Terminfo.Base.html#TERMINAL"><span class="hs-identifier hs-type">TERMINAL</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">setupterm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-identifier hs-type">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-comment">-- | Initialize the terminfo library to the given terminal entry.</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- </span><span>
</span><a name="line-76"></a><span class="hs-comment">-- Throws a 'SetupTermError' if the terminfo database could not be read.</span><span>
</span><a name="line-77"></a><span class="hs-identifier">setupTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a><span>
</span><a name="line-78"></a><a name="setupTerm"><a href="System.Console.Terminfo.Base.html#setupTerm"><span class="hs-identifier">setupTerm</span></a></a><span> </span><a name="local-6989586621679035884"><a href="#local-6989586621679035884"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-identifier hs-var">withCString</span><span> </span><a href="#local-6989586621679035884"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679035983"><a href="#local-6989586621679035983"><span class="hs-identifier">c_term</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-identifier hs-var">with</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679036025"><a href="#local-6989586621679036025"><span class="hs-identifier">ret_ptr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-81"></a><span>        </span><span class="hs-comment">-- NOTE: I believe that for the way we use terminfo</span><span>
</span><a name="line-82"></a><span>        </span><span class="hs-comment">-- (i.e. custom output function)</span><span>
</span><a name="line-83"></a><span>        </span><span class="hs-comment">-- this parameter does not affect anything.</span><span>
</span><a name="line-84"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679036026"><a href="#local-6989586621679036026"><span class="hs-identifier">stdOutput</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-85"></a><span>        </span><span class="hs-comment">-- Save the previous terminal to be restored after calling setupterm.</span><span>
</span><a name="line-86"></a><span>        </span><a name="local-6989586621679036027"><a href="#local-6989586621679036027"><span class="hs-identifier">old_term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-var">set_curterm</span></a><span> </span><span class="hs-identifier hs-var">nullPtr</span><span>
</span><a name="line-87"></a><span>        </span><span class="hs-comment">-- Call setupterm and check the return value.</span><span>
</span><a name="line-88"></a><span>        </span><a href="System.Console.Terminfo.Base.html#setupterm"><span class="hs-identifier hs-var">setupterm</span></a><span> </span><a href="#local-6989586621679035983"><span class="hs-identifier hs-var">c_term</span></a><span> </span><a href="#local-6989586621679036026"><span class="hs-identifier hs-var">stdOutput</span></a><span> </span><a href="#local-6989586621679036025"><span class="hs-identifier hs-var">ret_ptr</span></a><span>
</span><a name="line-89"></a><span>        </span><a name="local-6989586621679036028"><a href="#local-6989586621679036028"><span class="hs-identifier">ret</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">peek</span><span> </span><a href="#local-6989586621679036025"><span class="hs-identifier hs-var">ret_ptr</span></a><span>
</span><a name="line-90"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679036028"><span class="hs-identifier hs-var">ret</span></a><span> </span><span class="hs-operator hs-var">/=</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-var">SetupTermError</span></a><span>
</span><a name="line-92"></a><span>                </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Couldn't look up terminfo entry &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679035884"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-93"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-94"></a><span>                </span><a name="local-6989586621679039662"><a href="#local-6989586621679039662"><span class="hs-identifier">cterm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-var">set_curterm</span></a><span> </span><a href="#local-6989586621679036027"><span class="hs-identifier hs-var">old_term</span></a><span>
</span><a name="line-95"></a><span>                </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-var">Terminal</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">newForeignPtr</span><span> </span><a href="System.Console.Terminfo.Base.html#del_curterm"><span class="hs-identifier hs-var">del_curterm</span></a><span> </span><a href="#local-6989586621679039662"><span class="hs-identifier hs-var">cterm</span></a><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-keyword">data</span><span> </span><a name="SetupTermError"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier">SetupTermError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SetupTermError"><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier">SetupTermError</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-98"></a><span>                        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-type">SetupTermError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-101"></a><span>    </span><a name="local-8214565720323790560"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-var">SetupTermError</span></a><span> </span><a name="local-6989586621679042159"><a href="#local-6989586621679042159"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;setupTerm: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679042159"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="System.Console.Terminfo.Base.html#SetupTermError"><span class="hs-identifier hs-type">SetupTermError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-comment">-- | Initialize the terminfo library, using the @TERM@ environmental variable.</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- If @TERM@ is not set, we use the generic, minimal entry @dumb@.</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- </span><span>
</span><a name="line-108"></a><span class="hs-comment">-- Throws a 'SetupTermError' if the terminfo database could not be read.</span><span>
</span><a name="line-109"></a><span class="hs-identifier">setupTermFromEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a><span>
</span><a name="line-110"></a><a name="setupTermFromEnv"><a href="System.Console.Terminfo.Base.html#setupTermFromEnv"><span class="hs-identifier">setupTermFromEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-111"></a><span>    </span><a name="local-6989586621679040016"><a href="#local-6989586621679040016"><span class="hs-identifier">env_term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">handle</span><span> </span><a href="#local-6989586621679039690"><span class="hs-identifier hs-var">handleBadEnv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getEnv</span><span> </span><span class="hs-string">&quot;TERM&quot;</span><span> </span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679040017"><a href="#local-6989586621679040017"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679040016"><span class="hs-identifier hs-var">env_term</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;dumb&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679040016"><span class="hs-identifier hs-var">env_term</span></a><span>
</span><a name="line-113"></a><span>    </span><a href="System.Console.Terminfo.Base.html#setupTerm"><span class="hs-identifier hs-var">setupTerm</span></a><span> </span><a href="#local-6989586621679040017"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-114"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-identifier">handleBadEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IOException</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-116"></a><span>    </span><a name="local-6989586621679039690"><a href="#local-6989586621679039690"><span class="hs-identifier">handleBadEnv</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-comment">-- TODO: this isn't really thread-safe...</span><span>
</span><a name="line-119"></a><span class="hs-identifier">withCurTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679035883"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679035883"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-120"></a><a name="withCurTerm"><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier">withCurTerm</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-var">Terminal</span></a><span> </span><a name="local-6989586621679041070"><a href="#local-6989586621679041070"><span class="hs-identifier">term</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679041071"><a href="#local-6989586621679041071"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withForeignPtr</span><span> </span><a href="#local-6989586621679041070"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041072"><a href="#local-6989586621679041072"><span class="hs-identifier">cterm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-121"></a><span>        </span><a name="local-6989586621679041073"><a href="#local-6989586621679041073"><span class="hs-identifier">old_term</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-var">set_curterm</span></a><span> </span><a href="#local-6989586621679041072"><span class="hs-identifier hs-var">cterm</span></a><span>
</span><a name="line-122"></a><span>        </span><a name="local-6989586621679041074"><a href="#local-6989586621679041074"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679041071"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-123"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#set_curterm"><span class="hs-identifier hs-var">set_curterm</span></a><span> </span><a href="#local-6989586621679041073"><span class="hs-identifier hs-var">old_term</span></a><span>
</span><a name="line-124"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679041074"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">----------------------</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-comment">-- Note I'm relying on this working even for strings with unset parameters.</span><span>
</span><a name="line-130"></a><span class="hs-identifier">strHasPadding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-131"></a><a name="strHasPadding"><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier">strHasPadding</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-132"></a><span class="hs-identifier">strHasPadding</span><span> </span><span class="hs-special">(</span><span class="hs-char">'$'</span><span class="hs-glyph">:</span><span class="hs-char">'&lt;'</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-133"></a><span class="hs-identifier">strHasPadding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621679041075"><a href="#local-6989586621679041075"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var">strHasPadding</span></a><span> </span><a href="#local-6989586621679041075"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-comment">-- | An action which sends output to the terminal.  That output may mix plain text with control</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- characters and escape sequences, along with delays (called \&quot;padding\&quot;) required by some older</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- terminals.</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-comment">-- We structure this similarly to ShowS, so that appends don't cause space leaks.</span><span>
</span><a name="line-140"></a><span class="hs-keyword">newtype</span><span> </span><a name="TermOutput"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier">TermOutput</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TermOutput"><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier">TermOutput</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="System.Console.Terminfo.Base.html#TermOutputType"><span class="hs-identifier hs-type">TermOutputType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="System.Console.Terminfo.Base.html#TermOutputType"><span class="hs-identifier hs-type">TermOutputType</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-keyword">data</span><span> </span><a name="TermOutputType"><a href="System.Console.Terminfo.Base.html#TermOutputType"><span class="hs-identifier">TermOutputType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TOCmd"><a href="System.Console.Terminfo.Base.html#TOCmd"><span class="hs-identifier">TOCmd</span></a></a><span> </span><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-143"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a name="TOStr"><a href="System.Console.Terminfo.Base.html#TOStr"><span class="hs-identifier">TOStr</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-cpp">#if MIN_VERSION_base(4,9,0)</span><span>
</span><a name="line-146"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-147"></a><span>    </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a><span> </span><a name="local-6989586621679042157"><a href="#local-6989586621679042157"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-3458764513820541441"><span class="hs-operator">&lt;&gt;</span></a><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a><span> </span><a name="local-6989586621679042158"><a href="#local-6989586621679042158"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679042157"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679042158"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-150"></a><span>    </span><a name="local-3458764513820541442"><span class="hs-identifier">mempty</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-151"></a><span>    </span><a name="local-3458764513820541443"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-153"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Monoid</span><span> </span><span class="hs-identifier">TermOutput</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-identifier">mempty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TermOutput</span><span> </span><span class="hs-identifier">id</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-identifier">TermOutput</span><span> </span><span class="hs-identifier">xs</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">TermOutput</span><span> </span><span class="hs-identifier">ys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TermOutput</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">xs</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-identifier">termText</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span> </span><span>
</span><a name="line-159"></a><a name="termText"><a href="System.Console.Terminfo.Base.html#termText"><span class="hs-identifier">termText</span></a></a><span> </span><a name="local-6989586621679041076"><a href="#local-6989586621679041076"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#TOStr"><span class="hs-identifier hs-var">TOStr</span></a><span> </span><a href="#local-6989586621679041076"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- | Write the terminal output to the standard output device.</span><span>
</span><a name="line-162"></a><span class="hs-identifier">runTermOutput</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><a name="runTermOutput"><a href="System.Console.Terminfo.Base.html#runTermOutput"><span class="hs-identifier">runTermOutput</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#hRunTermOutput"><span class="hs-identifier hs-var">hRunTermOutput</span></a><span> </span><span class="hs-identifier hs-var">stdout</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- | Write the terminal output to the terminal or file managed by the given</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- 'Handle'.</span><span>
</span><a name="line-167"></a><span class="hs-identifier">hRunTermOutput</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><a name="hRunTermOutput"><a href="System.Console.Terminfo.Base.html#hRunTermOutput"><span class="hs-identifier">hRunTermOutput</span></a></a><span> </span><a name="local-6989586621679041146"><a href="#local-6989586621679041146"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041147"><a href="#local-6989586621679041147"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a><span> </span><a name="local-6989586621679041148"><a href="#local-6989586621679041148"><span class="hs-identifier">to</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-169"></a><span>    </span><a name="local-6989586621679041864"><a href="#local-6989586621679041864"><span class="hs-identifier">putc_ptr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#mkCallback"><span class="hs-identifier hs-var">mkCallback</span></a><span> </span><a href="#local-6989586621679041149"><span class="hs-identifier hs-var">putc</span></a><span>
</span><a name="line-170"></a><span>    </span><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier hs-var">withCurTerm</span></a><span> </span><a href="#local-6989586621679041147"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#writeToTerm"><span class="hs-identifier hs-var">writeToTerm</span></a><span> </span><a href="#local-6989586621679041864"><span class="hs-identifier hs-var">putc_ptr</span></a><span> </span><a href="#local-6989586621679041146"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041148"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-identifier hs-var">freeHaskellFunPtr</span><span> </span><a href="#local-6989586621679041864"><span class="hs-identifier hs-var">putc_ptr</span></a><span>
</span><a name="line-172"></a><span>    </span><span class="hs-identifier hs-var">hFlush</span><span> </span><a href="#local-6989586621679041146"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-173"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-174"></a><span>    </span><a name="local-6989586621679041149"><a href="#local-6989586621679041149"><span class="hs-identifier">putc</span></a></a><span> </span><a name="local-6989586621679041150"><a href="#local-6989586621679041150"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679041151"><a href="#local-6989586621679041151"><span class="hs-identifier">c'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679041150"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-175"></a><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">hPutChar</span><span> </span><a href="#local-6989586621679041146"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679041151"><span class="hs-identifier hs-var">c'</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">hFlush</span><span> </span><a href="#local-6989586621679041146"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679041150"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-comment">-- NOTE: Currently, the output is checked every time tparm is called.</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- It might be faster to check for padding once in tiGetOutput1.</span><span>
</span><a name="line-179"></a><span class="hs-identifier">writeToTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FunPtr</span><span> </span><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutputType"><span class="hs-identifier hs-type">TermOutputType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-180"></a><a name="writeToTerm"><a href="System.Console.Terminfo.Base.html#writeToTerm"><span class="hs-identifier">writeToTerm</span></a></a><span> </span><a name="local-6989586621679041865"><a href="#local-6989586621679041865"><span class="hs-identifier">putc</span></a></a><span> </span><a name="local-6989586621679041866"><a href="#local-6989586621679041866"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#TOCmd"><span class="hs-identifier hs-var">TOCmd</span></a><span> </span><a name="local-6989586621679041867"><a href="#local-6989586621679041867"><span class="hs-identifier">numLines</span></a></a><span> </span><a name="local-6989586621679041868"><a href="#local-6989586621679041868"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var">strHasPadding</span></a><span> </span><a href="#local-6989586621679041868"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#tPuts"><span class="hs-identifier hs-var">tPuts</span></a><span> </span><a href="#local-6989586621679041868"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679041867"><span class="hs-identifier hs-var">numLines</span></a><span> </span><a href="#local-6989586621679041865"><span class="hs-identifier hs-var">putc</span></a><span>
</span><a name="line-182"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679041866"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679041868"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-183"></a><span class="hs-identifier">writeToTerm</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041869"><a href="#local-6989586621679041869"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#TOStr"><span class="hs-identifier hs-var">TOStr</span></a><span> </span><a name="local-6989586621679041870"><a href="#local-6989586621679041870"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hPutStr</span><span> </span><a href="#local-6989586621679041869"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679041870"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator">&lt;#&gt;</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- | An operator version of 'mappend'.</span><span>
</span><a name="line-188"></a><span class="hs-special">(</span><span class="hs-operator">&lt;#&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679035446"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679035446"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679035446"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679035446"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-189"></a><span class="hs-special">(</span><a name="%3C%23%3E"><a href="System.Console.Terminfo.Base.html#%3C%23%3E"><span class="hs-operator">&lt;#&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mappend</span><span>
</span><a name="line-190"></a><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- | A feature or operation which a 'Terminal' may define.</span><span>
</span><a name="line-193"></a><span class="hs-keyword">newtype</span><span> </span><a name="Capability"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier">Capability</span></a></a><span> </span><a name="local-6989586621679034988"><a href="#local-6989586621679034988"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Capability"><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier">Capability</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679034988"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-identifier">getCapability</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Console.Terminfo.Base.html#Terminal"><span class="hs-identifier hs-type">Terminal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><a href="#local-6989586621679035445"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679035445"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-196"></a><a name="getCapability"><a href="System.Console.Terminfo.Base.html#getCapability"><span class="hs-identifier">getCapability</span></a></a><span> </span><a name="local-6989586621679041871"><a href="#local-6989586621679041871"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><a name="local-6989586621679041872"><a href="#local-6989586621679041872"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier hs-var">withCurTerm</span></a><span> </span><a href="#local-6989586621679041871"><span class="hs-identifier hs-var">term</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041872"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679041871"><span class="hs-identifier hs-var">term</span></a><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- Note that the instances for Capability of Functor, Monad and MonadPlus </span><span>
</span><a name="line-199"></a><span class="hs-comment">-- use the corresponding instances for Maybe.</span><span>
</span><a name="line-200"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-201"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-6989586621679042154"><a href="#local-6989586621679042154"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><a name="local-6989586621679042155"><a href="#local-6989586621679042155"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042156"><a href="#local-6989586621679042156"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679042154"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679042155"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679042156"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-204"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-208"></a><span>    </span><a name="local-3458764513820541102"><span class="hs-identifier">return</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span>
</span><a name="line-209"></a><span>    </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><a name="local-6989586621679042148"><a href="#local-6989586621679042148"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621679042149"><a href="#local-6989586621679042149"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042150"><a href="#local-6989586621679042150"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-210"></a><span>        </span><a name="local-6989586621679042151"><a href="#local-6989586621679042151"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679042148"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679042150"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-211"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679042151"><span class="hs-identifier hs-var">mx</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-212"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-213"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679042152"><a href="#local-6989586621679042152"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><a name="local-6989586621679042153"><a href="#local-6989586621679042153"><span class="hs-identifier">g'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042149"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679042152"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679042153"><span class="hs-identifier hs-var">g'</span></a><span> </span><a href="#local-6989586621679042150"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Alternative</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-216"></a><span>    </span><span class="hs-special">(</span><a name="local-8214565720323790675"><span class="hs-operator">&lt;|&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mplus</span><span>
</span><a name="line-217"></a><span>    </span><a name="local-8214565720323790676"><span class="hs-identifier">empty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadPlus</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-220"></a><span>    </span><a name="local-8214565720323790679"><span class="hs-identifier">mzero</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>    </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><a name="local-6989586621679042144"><a href="#local-6989586621679042144"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">`</span><a name="local-8214565720323790678"><span class="hs-identifier">mplus</span></a><span class="hs-special">`</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><a name="local-6989586621679042145"><a href="#local-6989586621679042145"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042146"><a href="#local-6989586621679042146"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-222"></a><span>        </span><a name="local-6989586621679042147"><a href="#local-6989586621679042147"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679042144"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679042146"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-223"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679042147"><span class="hs-identifier hs-var">mx</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-224"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679042145"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679042146"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-225"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679042147"><span class="hs-identifier hs-var">mx</span></a><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">tigetnum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CInt</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span class="hs-comment">-- | Look up a numeric capability in the terminfo database.</span><span>
</span><a name="line-230"></a><span class="hs-identifier">tiGetNum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span>
</span><a name="line-231"></a><a name="tiGetNum"><a href="System.Console.Terminfo.Base.html#tiGetNum"><span class="hs-identifier">tiGetNum</span></a></a><span> </span><a name="local-6989586621679041886"><a href="#local-6989586621679041886"><span class="hs-identifier">cap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-232"></a><span>                </span><a name="local-6989586621679041887"><a href="#local-6989586621679041887"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">withCString</span><span> </span><a href="#local-6989586621679041886"><span class="hs-identifier hs-var">cap</span></a><span> </span><a href="System.Console.Terminfo.Base.html#tigetnum"><span class="hs-identifier hs-var">tigetnum</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>                </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679041887"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-234"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679041887"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">tigetflag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CInt</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- | Look up a boolean capability in the terminfo database.  </span><span>
</span><a name="line-239"></a><span class="hs-comment">-- </span><span>
</span><a name="line-240"></a><span class="hs-comment">-- Unlike 'tiGuardFlag', this capability never fails; it returns 'False' if the</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- capability is absent or set to false, and returns 'True' otherwise.  </span><span>
</span><a name="line-242"></a><span class="hs-comment">-- </span><span>
</span><a name="line-243"></a><span class="hs-identifier">tiGetFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-244"></a><a name="tiGetFlag"><a href="System.Console.Terminfo.Base.html#tiGetFlag"><span class="hs-identifier">tiGetFlag</span></a></a><span> </span><a name="local-6989586621679041888"><a href="#local-6989586621679041888"><span class="hs-identifier">cap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-245"></a><span>                        </span><span class="hs-identifier hs-var">withCString</span><span> </span><a href="#local-6989586621679041888"><span class="hs-identifier hs-var">cap</span></a><span> </span><a href="System.Console.Terminfo.Base.html#tigetflag"><span class="hs-identifier hs-var">tigetflag</span></a><span>
</span><a name="line-246"></a><span>                </span><span>
</span><a name="line-247"></a><span class="hs-comment">-- | Look up a boolean capability in the terminfo database, and fail if</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- it\'s not defined.</span><span>
</span><a name="line-249"></a><span class="hs-identifier">tiGuardFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-250"></a><a name="tiGuardFlag"><a href="System.Console.Terminfo.Base.html#tiGuardFlag"><span class="hs-identifier">tiGuardFlag</span></a></a><span> </span><a name="local-6989586621679041889"><a href="#local-6989586621679041889"><span class="hs-identifier">cap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#tiGetFlag"><span class="hs-identifier hs-var">tiGetFlag</span></a><span> </span><a href="#local-6989586621679041889"><span class="hs-identifier hs-var">cap</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">guard</span><span>
</span><a name="line-251"></a><span>                </span><span>
</span><a name="line-252"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">tigetstr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CString</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-pragma">{-# DEPRECATED tiGetStr &quot;use tiGetOutput instead.&quot; #-}</span><span> </span><span>
</span><a name="line-255"></a><span class="hs-comment">-- | Look up a string capability in the terminfo database.  NOTE: This function is deprecated; use</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- 'tiGetOutput1' instead.</span><span>
</span><a name="line-257"></a><span class="hs-identifier">tiGetStr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-258"></a><a name="tiGetStr"><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier">tiGetStr</span></a></a><span> </span><a name="local-6989586621679041890"><a href="#local-6989586621679041890"><span class="hs-identifier">cap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-259"></a><span>                </span><a name="local-6989586621679041892"><a href="#local-6989586621679041892"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">withCString</span><span> </span><a href="#local-6989586621679041890"><span class="hs-identifier hs-var">cap</span></a><span> </span><a href="System.Console.Terminfo.Base.html#tigetstr"><span class="hs-identifier hs-var">tigetstr</span></a><span> </span><span>
</span><a name="line-260"></a><span>                </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679041892"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">nullPtr</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679041892"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679041891"><span class="hs-identifier hs-var">neg1Ptr</span></a><span>
</span><a name="line-261"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-262"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">peekCString</span><span> </span><a href="#local-6989586621679041892"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-264"></a><span>        </span><span class="hs-comment">-- hack; tigetstr sometimes returns (-1)</span><span>
</span><a name="line-265"></a><span>        </span><a name="local-6989586621679041891"><a href="#local-6989586621679041891"><span class="hs-identifier">neg1Ptr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nullPtr</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusPtr</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span>                    </span><span>
</span><a name="line-272"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">tparm</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-273"></a><span>    </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CLong</span><span> </span><span class="hs-comment">-- p1,...,p9</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CString</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-comment">-- Note: I may want to cut out the middleman and pipe tGoto/tGetStr together</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- with tput without a String marshall in the middle.</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- directly without </span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-identifier">tParm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-282"></a><a name="tParm"><a href="System.Console.Terminfo.Base.html#tParm"><span class="hs-identifier">tParm</span></a></a><span> </span><a name="local-6989586621679041893"><a href="#local-6989586621679041893"><span class="hs-identifier">cap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-var">Capability</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041906"><a href="#local-6989586621679041906"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041907"><a href="#local-6989586621679041907"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Console.Terminfo.Base.html#withCurTerm"><span class="hs-identifier hs-var">withCurTerm</span></a><span> </span><a href="#local-6989586621679041906"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-284"></a><span>                    </span><a href="#local-6989586621679041894"><span class="hs-identifier hs-var">tparm'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><a href="#local-6989586621679041907"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679041894"><a href="#local-6989586621679041894"><span class="hs-identifier">tparm'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679041895"><a href="#local-6989586621679041895"><span class="hs-identifier">p1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679041896"><a href="#local-6989586621679041896"><span class="hs-identifier">p2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679041897"><a href="#local-6989586621679041897"><span class="hs-identifier">p3</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679041898"><a href="#local-6989586621679041898"><span class="hs-identifier">p4</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679041899"><a href="#local-6989586621679041899"><span class="hs-identifier">p5</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679041900"><a href="#local-6989586621679041900"><span class="hs-identifier">p6</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679041901"><a href="#local-6989586621679041901"><span class="hs-identifier">p7</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679041902"><a href="#local-6989586621679041902"><span class="hs-identifier">p8</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679041903"><a href="#local-6989586621679041903"><span class="hs-identifier">p9</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withCString</span><span> </span><a href="#local-6989586621679041893"><span class="hs-identifier hs-var">cap</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041904"><a href="#local-6989586621679041904"><span class="hs-identifier">c_cap</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-287"></a><span>                </span><a name="local-6989586621679041905"><a href="#local-6989586621679041905"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#tparm"><span class="hs-identifier hs-var">tparm</span></a><span> </span><a href="#local-6989586621679041904"><span class="hs-identifier hs-var">c_cap</span></a><span> </span><a href="#local-6989586621679041895"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621679041896"><span class="hs-identifier hs-var">p2</span></a><span> </span><a href="#local-6989586621679041897"><span class="hs-identifier hs-var">p3</span></a><span> </span><a href="#local-6989586621679041898"><span class="hs-identifier hs-var">p4</span></a><span> </span><a href="#local-6989586621679041899"><span class="hs-identifier hs-var">p5</span></a><span> </span><a href="#local-6989586621679041900"><span class="hs-identifier hs-var">p6</span></a><span> </span><a href="#local-6989586621679041901"><span class="hs-identifier hs-var">p7</span></a><span> </span><a href="#local-6989586621679041902"><span class="hs-identifier hs-var">p8</span></a><span> </span><a href="#local-6989586621679041903"><span class="hs-identifier hs-var">p9</span></a><span>
</span><a name="line-288"></a><span>                </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679041905"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">nullPtr</span><span>
</span><a name="line-289"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-290"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">peekCString</span><span> </span><a href="#local-6989586621679041905"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-291"></a><span>          </span><span class="hs-identifier">tparm'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;tParm: List too short&quot;</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- | Look up an output capability in the terminfo database.  </span><span>
</span><a name="line-294"></a><span class="hs-identifier">tiGetOutput</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span class="hs-special">)</span><span>
</span><a name="line-295"></a><a name="tiGetOutput"><a href="System.Console.Terminfo.Base.html#tiGetOutput"><span class="hs-identifier">tiGetOutput</span></a></a><span> </span><a name="local-6989586621679042091"><a href="#local-6989586621679042091"><span class="hs-identifier">cap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-296"></a><span>    </span><a name="local-6989586621679042092"><a href="#local-6989586621679042092"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier hs-var">tiGetStr</span></a><span> </span><a href="#local-6989586621679042091"><span class="hs-identifier hs-var">cap</span></a><span>
</span><a name="line-297"></a><span>    </span><a name="local-6989586621679042093"><a href="#local-6989586621679042093"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#tParm"><span class="hs-identifier hs-var">tParm</span></a><span> </span><a href="#local-6989586621679042092"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-298"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042094"><a href="#local-6989586621679042094"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621679042095"><a href="#local-6989586621679042095"><span class="hs-identifier">la</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#fromStr"><span class="hs-identifier hs-var">fromStr</span></a><span> </span><a href="#local-6989586621679042095"><span class="hs-identifier hs-var">la</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679042093"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679042094"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-identifier">fromStr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span>
</span><a name="line-301"></a><a name="fromStr"><a href="System.Console.Terminfo.Base.html#fromStr"><span class="hs-identifier">fromStr</span></a></a><span> </span><a name="local-6989586621679042096"><a href="#local-6989586621679042096"><span class="hs-identifier">la</span></a></a><span> </span><a name="local-6989586621679042097"><a href="#local-6989586621679042097"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-var">TermOutput</span></a><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#TOCmd"><span class="hs-identifier hs-var">TOCmd</span></a><span> </span><a href="#local-6989586621679042096"><span class="hs-identifier hs-var">la</span></a><span> </span><a href="#local-6989586621679042097"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-keyword">type</span><span> </span><a name="CharOutput"><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier">CharOutput</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CInt</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-string">&quot;wrapper&quot;</span><span> </span><span class="hs-identifier">mkCallback</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FunPtr</span><span> </span><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-identifier">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ccall</span><span> </span><span class="hs-identifier">tputs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FunPtr</span><span> </span><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- | A parameter to specify the number of lines affected.  Some capabilities</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- (e.g., @clear@ and @dch1@) use</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- this parameter on some terminals to compute variable-length padding.</span><span>
</span><a name="line-312"></a><span class="hs-keyword">type</span><span> </span><a name="LinesAffected"><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier">LinesAffected</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">-- | Output a string capability.  Applys padding information to the string if</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- necessary.</span><span>
</span><a name="line-316"></a><span class="hs-identifier">tPuts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#LinesAffected"><span class="hs-identifier hs-type">LinesAffected</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FunPtr</span><span> </span><a href="System.Console.Terminfo.Base.html#CharOutput"><span class="hs-identifier hs-type">CharOutput</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-317"></a><a name="tPuts"><a href="System.Console.Terminfo.Base.html#tPuts"><span class="hs-identifier">tPuts</span></a></a><span> </span><a name="local-6989586621679042098"><a href="#local-6989586621679042098"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679042099"><a href="#local-6989586621679042099"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679042100"><a href="#local-6989586621679042100"><span class="hs-identifier">putc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withCString</span><span> </span><a href="#local-6989586621679042098"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042101"><a href="#local-6989586621679042101"><span class="hs-identifier">c_str</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#tputs"><span class="hs-identifier hs-var">tputs</span></a><span> </span><a href="#local-6989586621679042101"><span class="hs-identifier hs-var">c_str</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toEnum</span><span> </span><a href="#local-6989586621679042099"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679042100"><span class="hs-identifier hs-var">putc</span></a><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">-- | Look up an output capability which takes a fixed number of parameters</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- (for example, @Int -&gt; Int -&gt; TermOutput@).</span><span>
</span><a name="line-322"></a><span class="hs-comment">-- </span><span>
</span><a name="line-323"></a><span class="hs-comment">-- For capabilities which may contain variable-length</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- padding, use 'tiGetOutput' instead.</span><span>
</span><a name="line-325"></a><span class="hs-identifier">tiGetOutput1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679035335"><a href="#local-6989586621679035335"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a><span> </span><a href="#local-6989586621679035335"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#Capability"><span class="hs-identifier hs-type">Capability</span></a><span> </span><a href="#local-6989586621679035335"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-326"></a><a name="tiGetOutput1"><a href="System.Console.Terminfo.Base.html#tiGetOutput1"><span class="hs-identifier">tiGetOutput1</span></a></a><span> </span><a name="local-6989586621679042102"><a href="#local-6989586621679042102"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-327"></a><span>    </span><a name="local-6989586621679042103"><a href="#local-6989586621679042103"><span class="hs-identifier">cap</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#tiGetStr"><span class="hs-identifier hs-var">tiGetStr</span></a><span> </span><a href="#local-6989586621679042102"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-328"></a><span>    </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier hs-var">hasOkPadding</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679035335"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679042103"><span class="hs-identifier hs-var">cap</span></a><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>    </span><a name="local-6989586621679042134"><a href="#local-6989586621679042134"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Console.Terminfo.Base.html#tParm"><span class="hs-identifier hs-var">tParm</span></a><span> </span><a href="#local-6989586621679042103"><span class="hs-identifier hs-var">cap</span></a><span>
</span><a name="line-330"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier hs-var">outputCap</span></a><span> </span><a href="#local-6989586621679042134"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-comment">-- OK, this is the structure that I want:</span><span>
</span><a name="line-334"></a><span class="hs-keyword">class</span><span> </span><a name="OutputCap"><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier">OutputCap</span></a></a><span> </span><a name="local-6989586621679030143"><a href="#local-6989586621679030143"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-335"></a><span>    </span><span class="hs-identifier">hasOkPadding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679030143"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-336"></a><span>    </span><span class="hs-identifier">outputCap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679030143"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-keyword">instance</span><span> </span><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-339"></a><span>    </span><a name="local-8214565720323804180"><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier">hasOkPadding</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.Console.Terminfo.Base.html#strHasPadding"><span class="hs-identifier hs-var">strHasPadding</span></a><span> </span><span>
</span><a name="line-340"></a><span>    </span><a name="local-8214565720323804181"><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier">outputCap</span></a></a><span> </span><a name="local-6989586621679042142"><a href="#local-6989586621679042142"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679042143"><a href="#local-6989586621679042143"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042142"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679042143"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-keyword">instance</span><span> </span><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-343"></a><span>    </span><a name="local-8214565720323804180"><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier">hasOkPadding</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-344"></a><span>    </span><a name="local-8214565720323804181"><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier">outputCap</span></a></a><span> </span><a name="local-6989586621679042140"><a href="#local-6989586621679042140"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679042141"><a href="#local-6989586621679042141"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#fromStr"><span class="hs-identifier hs-var">fromStr</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679042140"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679042141"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Enum</span><span> </span><a href="#local-6989586621679042135"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">,</span><span> </span><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a><span> </span><a href="#local-6989586621679042136"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679042135"><span class="hs-identifier hs-type">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679042136"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-347"></a><span>    </span><a name="local-8214565720323804181"><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier">outputCap</span></a></a><span> </span><a name="local-6989586621679042137"><a href="#local-6989586621679042137"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679042138"><a href="#local-6989586621679042138"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042139"><a href="#local-6989586621679042139"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Console.Terminfo.Base.html#outputCap"><span class="hs-identifier hs-var">outputCap</span></a><span> </span><a href="#local-6989586621679042137"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679042139"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679042138"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>    </span><a name="local-8214565720323804180"><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier">hasOkPadding</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Console.Terminfo.Base.html#hasOkPadding"><span class="hs-identifier hs-var">hasOkPadding</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679042136"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span class="hs-comment">{- $outputdoc
Terminfo contains many string capabilities for special effects.
For example, the @cuu1@ capability moves the cursor up one line; on ANSI terminals
this is accomplished by printing the control sequence @\&quot;\\ESC[A\&quot;@.
However, some older terminals also require \&quot;padding\&quot;, or short pauses, after certain commands.
For example, when @TERM=vt100@ the @cuu1@ capability is @\&quot;\\ESC[A$\&lt;2\&gt;\&quot;@, which instructs terminfo
to pause for two milliseconds after outputting the control sequence.

The 'TermOutput' monoid abstracts away all padding and control
sequence output.  Unfortunately, that datatype is difficult to integrate into existing 'String'-based APIs
such as pretty-printers.  Thus, as a workaround, 'tiGetOutput1' also lets us access the control sequences as 'String's.  The one caveat is that it will not allow you to access padded control sequences as Strings.  For example:

   &gt; &gt; t &lt;- setupTerm &quot;vt100&quot;
   &gt; &gt; isJust (getCapability t (tiGetOutput1 &quot;cuu1&quot;) :: Maybe String)
   &gt; False
   &gt; &gt; isJust (getCapability t (tiGetOutput1 &quot;cuu1&quot;) :: Maybe TermOutput)
   &gt; True

'String' capabilities will work with software-based terminal types such as @xterm@ and @linux@.
However, you should use 'TermOutput' if compatibility with older terminals is important.
Additionally, the @visualBell@ capability which flashes the screen usually produces its effect with a padding directive, so it will only work with 'TermOutput'.

-}</span><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-6989586621679030142"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="System.Console.Terminfo.Base.html#OutputCap"><span class="hs-identifier hs-type">OutputCap</span></a><span> </span><a href="#local-6989586621679030142"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="TermStr"><a href="System.Console.Terminfo.Base.html#TermStr"><span class="hs-identifier">TermStr</span></a></a><span> </span><a name="local-6989586621679030142"><a href="#local-6989586621679030142"><span class="hs-identifier">s</span></a></a><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-keyword">instance</span><span> </span><a href="System.Console.Terminfo.Base.html#TermStr"><span class="hs-identifier hs-type">TermStr</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span>
</span><a name="line-379"></a><span class="hs-keyword">instance</span><span> </span><a href="System.Console.Terminfo.Base.html#TermStr"><span class="hs-identifier hs-type">TermStr</span></a><span> </span><a href="System.Console.Terminfo.Base.html#TermOutput"><span class="hs-identifier hs-type">TermOutput</span></a><span>
</span><a name="line-380"></a></pre></body></html>