<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-comment">{- |
Module      :  Lens.Micro
Copyright   :  (C) 2013-2016 Edward Kmett, 2015-2016 Artyom
License     :  BSD-style (see the file LICENSE)

This module provides the essential functionality. There are other packages in the microlens family &#8211; mix and match them at will. If you're writing an app, you want &lt;http://hackage.haskell.org/package/microlens-platform microlens-platform&gt; &#8211; it provides the most functionality.

* &lt;http://hackage.haskell.org/package/microlens-mtl microlens-mtl&gt; &#8211; (@+=@) and friends, @use@, @zoom@\/@magnify@
* &lt;http://hackage.haskell.org/package/microlens-th microlens-th&gt; &#8211; @makeLenses@ and @makeFields@
* &lt;http://hackage.haskell.org/package/microlens-ghc microlens-ghc&gt; &#8211; everything in microlens + instances to make @each@\/@at@\/@ix@ usable with arrays, @ByteString@, and containers
* &lt;http://hackage.haskell.org/package/microlens-platform microlens-platform&gt; &#8211; microlens-ghc + microlens-mtl + microlens-th + instances for @Text@, @Vector@, and @HashMap@
* &lt;http://hackage.haskell.org/package/microlens-contra microlens-contra&gt; &#8211; @Fold@ and @Getter@ that are exact copies of types in lens

Unofficial:

* &lt;http://hackage.haskell.org/package/microlens-aeson microlens-aeson&gt; &#8211; a port of &lt;http://hackage.haskell.org/package/lens-aeson lens-aeson&gt;

-}</span><span>
</span><a name="line-30"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lens</span><span class="hs-operator">.</span><span class="hs-identifier">Micro</span><span>
</span><a name="line-31"></a><span class="hs-special">(</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>  </span><span class="hs-comment">-- $ampersand-note</span><span>
</span><a name="line-34"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#%3C%26%3E"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>  </span><span class="hs-comment">-- * Setter: modifies something in a structure</span><span>
</span><a name="line-37"></a><span>  </span><span class="hs-comment">-- $setters-note</span><span>
</span><a name="line-38"></a><span>  </span><a href="Lens.Micro.Type.html#ASetter"><span class="hs-identifier hs-type">ASetter</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Type.html#ASetter%27"><span class="hs-identifier hs-type">ASetter'</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>  </span><a href="Lens.Micro.Internal.html#sets"><span class="hs-identifier hs-var">sets</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Lens.Micro.html#over"><span class="hs-identifier hs-var">over</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Lens.Micro.html#set"><span class="hs-identifier hs-var">set</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#%3F~"><span class="hs-operator hs-var">?~</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#%3C%25~"><span class="hs-operator hs-var">&lt;%~</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#%3C%3C%25~"><span class="hs-operator hs-var">&lt;&lt;%~</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#%3C%3C.~"><span class="hs-operator hs-var">&lt;&lt;.~</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>  </span><a href="Lens.Micro.html#mapped"><span class="hs-identifier hs-var">mapped</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-comment">-- * Getter: extracts a value from a structure</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-comment">-- $getters-note</span><span>
</span><a name="line-48"></a><span>  </span><a href="Lens.Micro.Type.html#SimpleGetter"><span class="hs-identifier hs-type">SimpleGetter</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>  </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>  </span><a href="Lens.Micro.html#to"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span>  </span><span class="hs-comment">-- * Fold: extracts multiple elements</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-comment">-- $folds-note</span><span>
</span><a name="line-55"></a><span>  </span><a href="Lens.Micro.Type.html#SimpleFold"><span class="hs-identifier hs-type">SimpleFold</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#%5E.."><span class="hs-operator hs-var">^..</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Lens.Micro.html#toListOf"><span class="hs-identifier hs-var">toListOf</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>  </span><span class="hs-special">(</span><a href="Lens.Micro.html#%5E%3F%21"><span class="hs-operator hs-var">^?!</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>  </span><a href="Lens.Micro.html#traverseOf_"><span class="hs-identifier hs-var">traverseOf_</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>  </span><a href="Lens.Micro.html#forOf_"><span class="hs-identifier hs-var">forOf_</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>  </span><a href="Lens.Micro.html#has"><span class="hs-identifier hs-var">has</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>  </span><a href="Lens.Micro.Internal.html#folded"><span class="hs-identifier hs-var">folded</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>  </span><a href="Lens.Micro.html#folding"><span class="hs-identifier hs-var">folding</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span>  </span><span class="hs-comment">-- * Lens: a combined getter-and-setter</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-comment">-- $lenses-note</span><span>
</span><a name="line-67"></a><span>  </span><a href="Lens.Micro.Type.html#Lens"><span class="hs-identifier hs-type">Lens</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>  </span><a href="Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>  </span><a href="Lens.Micro.Internal.html#at"><span class="hs-identifier hs-var">at</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>  </span><a href="Lens.Micro.Internal.html#_1"><span class="hs-identifier hs-var">_1</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Internal.html#_2"><span class="hs-identifier hs-var">_2</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Internal.html#_3"><span class="hs-identifier hs-var">_3</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Internal.html#_4"><span class="hs-identifier hs-var">_4</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Internal.html#_5"><span class="hs-identifier hs-var">_5</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span>  </span><span class="hs-comment">-- * Iso: a lens that only changes the representation</span><span>
</span><a name="line-73"></a><span>  </span><span class="hs-comment">-- $isos-note</span><span>
</span><a name="line-74"></a><span>  </span><a href="Lens.Micro.Internal.html#strict"><span class="hs-identifier hs-var">strict</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Internal.html#lazy"><span class="hs-identifier hs-var">lazy</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>  </span><a href="Lens.Micro.html#non"><span class="hs-identifier hs-var">non</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>  </span><span class="hs-comment">-- * Traversal: a lens iterating over several elements</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-comment">-- $traversals-note</span><span>
</span><a name="line-79"></a><span>  </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Type.html#Traversal%27"><span class="hs-identifier hs-type">Traversal'</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>  </span><a href="Lens.Micro.html#traverseOf"><span class="hs-identifier hs-var">traverseOf</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>  </span><a href="Lens.Micro.html#forOf"><span class="hs-identifier hs-var">forOf</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>  </span><a href="Lens.Micro.html#singular"><span class="hs-identifier hs-var">singular</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>  </span><a href="Lens.Micro.html#failing"><span class="hs-identifier hs-var">failing</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>  </span><a href="Lens.Micro.html#filtered"><span class="hs-identifier hs-var">filtered</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>  </span><a href="Lens.Micro.html#both"><span class="hs-identifier hs-var">both</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>  </span><a href="Lens.Micro.Internal.html#traversed"><span class="hs-identifier hs-var">traversed</span></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>  </span><a href="Lens.Micro.Internal.html#each"><span class="hs-identifier hs-var">each</span></a><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>  </span><a href="Lens.Micro.Internal.html#ix"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>  </span><a href="Lens.Micro.html#_head"><span class="hs-identifier hs-var">_head</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.html#_tail"><span class="hs-identifier hs-var">_tail</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.html#_init"><span class="hs-identifier hs-var">_init</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.html#_last"><span class="hs-identifier hs-var">_last</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>  </span><a href="Lens.Micro.html#mapAccumLOf"><span class="hs-identifier hs-var">mapAccumLOf</span></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-comment">-- * Prism: a traversal iterating over at most 1 element</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-comment">-- $prisms-note</span><span>
</span><a name="line-94"></a><span>  </span><a href="Lens.Micro.html#_Left"><span class="hs-identifier hs-var">_Left</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.html#_Right"><span class="hs-identifier hs-var">_Right</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>  </span><a href="Lens.Micro.html#_Just"><span class="hs-identifier hs-var">_Just</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.html#_Nothing"><span class="hs-identifier hs-var">_Nothing</span></a><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>  </span><span class="hs-comment">-- * Other types</span><span>
</span><a name="line-98"></a><span>  </span><a href="Lens.Micro.Type.html#LensLike"><span class="hs-identifier hs-type">LensLike</span></a><span class="hs-special">,</span><span> </span><a href="Lens.Micro.Type.html#LensLike%27"><span class="hs-identifier hs-type">LensLike'</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-keyword">where</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><a href="Lens.Micro.Type.html"><span class="hs-identifier">Lens</span><span class="hs-operator">.</span><span class="hs-identifier">Micro</span><span class="hs-operator">.</span><span class="hs-identifier">Type</span></a><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><a href="Lens.Micro.Internal.html"><span class="hs-identifier">Lens</span><span class="hs-operator">.</span><span class="hs-identifier">Micro</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Functor</span><span class="hs-operator">.</span><span class="hs-identifier">Identity</span><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Tuple</span><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">F</span><span>
</span><a name="line-113"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unsafe</span><span class="hs-operator">.</span><span class="hs-identifier">Coerce</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 710</span><span>
</span><a name="line-116"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Function</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-comment">-- This is for the reimplementation of State</span><span>
</span><a name="line-120"></a><span class="hs-cpp">#if MIN_VERSION_base(4,9,0)</span><span>
</span><a name="line-121"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Fail</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Fail</span><span>
</span><a name="line-122"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-comment">{- $setup
-- &gt;&gt;&gt; import Data.Char (toUpper)
-- &gt;&gt;&gt; import Control.Arrow (first, second, left, right)
-}</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &lt; 710</span><span>
</span><a name="line-131"></a><span class="hs-comment">{- |
'&amp;' is a reverse application operator. This provides notational convenience. Its precedence is one higher than that of the forward application operator '$', which allows '&amp;' to be nested in '$'.
-}</span><span>
</span><a name="line-134"></a><span class="hs-special">(</span><span class="hs-operator">&amp;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">b</span><span>
</span><a name="line-135"></a><span class="hs-identifier">a</span><span> </span><span class="hs-operator">&amp;</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-136"></a><span class="hs-pragma">{-# INLINE (&amp;) #-}</span><span>
</span><a name="line-137"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator">&amp;</span><span>
</span><a name="line-138"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">{- $ampersand-note

This operator is useful when you want to modify something several times. For instance, if you want to change 1st and 3rd elements of a tuple, you can write this:

@
(1,2,3) '&amp;' '_1' '.~' 0
        '&amp;' '_3' '%~' 'negate'
@

instead of e.g. this:

@
('_1' '.~' 0) '.' ('_3' '%~' 'negate') '$' (1,2,3)
@

or this:

@
'set' '_1' 0 '.'
'over' '_3' 'negate'
  '$' (1,2,3)
@
-}</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">{- |
('&lt;&amp;&gt;') is flipped ('&lt;$&gt;'):

@
x '&lt;&amp;&gt;' f = f '&lt;$&gt;' x
@

It's often useful when writing lenses. For instance, let's say you're writing 'ix' for @Map@; if the key is found in the map, you have to apply a function to it and then change the map based on the new value &#8211; which requires a lambda, like this:

@
'ix' key f map = case Map.lookup key map of
     Just val -&gt; (\\val' -&gt; Map.insert key val' map) '&lt;$&gt;' f val
     Nothing  -&gt; 'pure' map
@

With ('&lt;&amp;&gt;') you can get rid of parentheses and move the long lambda expression to the right of the value (like when you use '&gt;&gt;='):

@
'ix' key f map = case Map.lookup key map of
     Just val -&gt; f val '&lt;&amp;&gt;' \\val' -&gt; Map.insert key val' map
     Nothing  -&gt; 'pure' map
@
-}</span><span>
</span><a name="line-187"></a><span class="hs-special">(</span><span class="hs-operator">&lt;&amp;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679040746"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679040746"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040747"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040747"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040748"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040746"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040748"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-188"></a><span class="hs-special">(</span><a name="%3C%26%3E"><a href="Lens.Micro.html#%3C%26%3E"><span class="hs-operator">&lt;&amp;&gt;</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679040749"><a href="#local-6989586621679040749"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679040750"><a href="#local-6989586621679040750"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040750"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679040749"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-189"></a><span class="hs-pragma">{-# INLINE (&lt;&amp;&gt;) #-}</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator">&lt;&amp;&gt;</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-comment">-- Setting -----------------------------------------------------------------</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-comment">{- $setters-note

A setter is, broadly speaking, something that lets you modify a part of some value. Most likely you already know some setters:

  * @'Control.Arrow.first' :: (a -&gt; b) -&gt; (a, x) -&gt; (b, x)@

      (modifies 1st element of a pair; corresponds to 'Lens.Micro._1')

  * @'Control.Arrow.left' :: (a -&gt; b) -&gt; 'Either' a x -&gt; 'Either' b x@

      (modifies left branch of 'Either'; corresponds to 'Lens.Micro._Left')

  * @'map' :: (a -&gt; b) -&gt; [a] -&gt; [b]@

      (modifies every element in a list; corresponds to 'Lens.Micro.mapped')

As you see, a setter takes a function, a value, and applies the function to some part (or several parts) of the value. Moreover, setters can be pretty specific &#8211; for instance, a function that modifies the 3rd element of a list is a setter too:

@
-- Modify 3rd element in a list, if present.
modify3rd :: (a -&gt; a) -&gt; [a] -&gt; [a]
modify3rd f (a:b:c:xs) = a : b : f c : xs
modify3rd _ xs         = xs
@

A nice thing about setters is that they compose easily &#8211; you can write @'map' '.' 'Control.Arrow.left'@ and it would be a function that takes a list of 'Either's and modifies all of them that are 'Left's.

This library provides its own type for setters &#8211; 'ASetter'; it's needed so that some functions in this library (like '_1') would be usable both as setters and as getters. You can turn an ordinary function like 'map' to a &#8220;lensy&#8221; setter with 'sets'.

To apply a setter to a value, use ('%~') or 'over':

&gt;&gt;&gt; [1,2,3] &amp; mapped %~ succ
[2,3,4]
&gt;&gt;&gt; over _head toUpper &quot;jane&quot;
&quot;Jane&quot;

To modify a value deeper inside the structure, use ('.'):

&gt;&gt;&gt; [&quot;abc&quot;,&quot;def&quot;,&quot;ghi&quot;] &amp; ix 1 . ix 2 %~ toUpper
[&quot;abc&quot;,&quot;deF&quot;,&quot;ghi&quot;]

To set a value instead of modifying it, use 'set' or ('.~'):

&gt;&gt;&gt; &quot;abc&quot; &amp; mapped .~ 'x'
&quot;xxx&quot;
&gt;&gt;&gt; set _2 'X' ('a','b','c')
('a','X','c')

It's also possible to get both the old and the new value back &#8211; see ('&lt;%~') and ('&lt;&lt;%~').
-}</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-comment">{- |
('%~') applies a function to the target; an alternative explanation is that it is an inverse of 'sets', which turns a setter into an ordinary function. @'mapped' '%~' 'reverse'@ is the same thing as @'fmap' 'reverse'@.

See 'over' if you want a non-operator synonym.

Negating the 1st element of a pair:

&gt;&gt;&gt; (1,2) &amp; _1 %~ negate
(-1,2)

Turning all @Left@s in a list to upper case:

&gt;&gt;&gt; (mapped._Left.mapped %~ toUpper) [Left &quot;foo&quot;, Right &quot;bar&quot;]
[Left &quot;FOO&quot;,Right &quot;bar&quot;]
-}</span><span>
</span><a name="line-261"></a><span class="hs-special">(</span><span class="hs-operator">%~</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#ASetter"><span class="hs-identifier hs-type">ASetter</span></a><span> </span><a href="#local-6989586621679040742"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040743"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040744"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040745"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040744"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040745"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040742"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040743"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-262"></a><span class="hs-special">(</span><a name="%25~"><a href="Lens.Micro.html#%25~"><span class="hs-operator">%~</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#over"><span class="hs-identifier hs-var">over</span></a><span>
</span><a name="line-263"></a><span class="hs-pragma">{-# INLINE (%~) #-}</span><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator">%~</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">{- |
'over' is a synonym for ('%~').

Getting 'fmap' in a roundabout way:

@
'over' 'mapped' :: 'Functor' f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
'over' 'mapped' = 'fmap'
@

Applying a function to both components of a pair:

@
'over' 'both' :: (a -&gt; b) -&gt; (a, a) -&gt; (b, b)
'over' 'both' = \\f t -&gt; (f (fst t), f (snd t))
@

Using @'over' '_2'@ as a replacement for 'Control.Arrow.second':

&gt;&gt;&gt; over _2 show (10,20)
(10,&quot;20&quot;)
-}</span><span>
</span><a name="line-289"></a><span class="hs-identifier">over</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#ASetter"><span class="hs-identifier hs-type">ASetter</span></a><span> </span><a href="#local-6989586621679040738"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040739"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040740"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040741"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040740"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040741"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040738"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040739"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-290"></a><a name="over"><a href="Lens.Micro.html#over"><span class="hs-identifier">over</span></a></a><span> </span><a name="local-6989586621679040751"><a href="#local-6989586621679040751"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679040752"><a href="#local-6989586621679040752"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><a href="Lens.Micro.Internal.html#%23."><span class="hs-operator hs-var">#.</span></a><span> </span><a href="#local-6989586621679040751"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Identity</span><span> </span><a href="Lens.Micro.Internal.html#%23."><span class="hs-operator hs-var">#.</span></a><span> </span><a href="#local-6989586621679040752"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span class="hs-pragma">{-# INLINE over #-}</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">{- |
('.~') assigns a value to the target. It's the same thing as using ('%~') with 'const':

@
l '.~' x = l '%~' 'const' x
@

See 'set' if you want a non-operator synonym.

Here it is used to change 2 fields of a 3-tuple:

&gt;&gt;&gt; (0,0,0) &amp; _1 .~ 1 &amp; _3 .~ 3
(1,0,3)
-}</span><span>
</span><a name="line-307"></a><span class="hs-special">(</span><span class="hs-operator">.~</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#ASetter"><span class="hs-identifier hs-type">ASetter</span></a><span> </span><a href="#local-6989586621679040734"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040735"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040736"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040737"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040737"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040734"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040735"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-308"></a><span class="hs-special">(</span><a name=".~"><a href="Lens.Micro.html#.~"><span class="hs-operator">.~</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#set"><span class="hs-identifier hs-var">set</span></a><span>
</span><a name="line-309"></a><span class="hs-pragma">{-# INLINE (.~) #-}</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator">.~</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-comment">{- |
'set' is a synonym for ('.~').

Setting the 1st component of a pair:

@
'set' '_1' :: x -&gt; (a, b) -&gt; (x, b)
'set' '_1' = \\x t -&gt; (x, snd t)
@

Using it to rewrite ('Data.Functor.&lt;$'):

@
'set' 'mapped' :: 'Functor' f =&gt; a -&gt; f b -&gt; f a
'set' 'mapped' = ('Data.Functor.&lt;$')
@
-}</span><span>
</span><a name="line-330"></a><span class="hs-identifier">set</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#ASetter"><span class="hs-identifier hs-type">ASetter</span></a><span> </span><a href="#local-6989586621679040730"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040731"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040732"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040733"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040733"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040730"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040731"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-331"></a><a name="set"><a href="Lens.Micro.html#set"><span class="hs-identifier">set</span></a></a><span> </span><a name="local-6989586621679040753"><a href="#local-6989586621679040753"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679040754"><a href="#local-6989586621679040754"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><a href="Lens.Micro.Internal.html#%23."><span class="hs-operator hs-var">#.</span></a><span> </span><a href="#local-6989586621679040753"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Identity</span><span> </span><a href="#local-6989586621679040754"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span class="hs-pragma">{-# INLINE set #-}</span><span>
</span><a name="line-333"></a><span>
</span><a name="line-334"></a><span class="hs-comment">{- |
('?~') is a version of ('.~') that wraps the value into 'Just' before setting.

@
l ?~ b = l .~ Just b
@

It can be useful in combination with 'at':

&gt;&gt;&gt; Map.empty &amp; at 3 ?~ x
fromList [(3,x)]
-}</span><span>
</span><a name="line-346"></a><span class="hs-special">(</span><span class="hs-operator">?~</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#ASetter"><span class="hs-identifier hs-type">ASetter</span></a><span> </span><a href="#local-6989586621679040726"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040727"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040728"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679040729"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040729"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040726"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040727"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-347"></a><a name="local-6989586621679040755"><a href="#local-6989586621679040755"><span class="hs-identifier">l</span></a></a><span> </span><a name="%3F~"><a href="Lens.Micro.html#%3F~"><span class="hs-operator">?~</span></a></a><span> </span><a name="local-6989586621679040756"><a href="#local-6989586621679040756"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#set"><span class="hs-identifier hs-var">set</span></a><span> </span><a href="#local-6989586621679040755"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679040756"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span class="hs-pragma">{-# INLINE (?~) #-}</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator">?~</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span class="hs-comment">{- |
'mapped' is a setter for everything contained in a functor. You can use it to map over lists, @Maybe@, or even @IO@ (which is something you can't do with 'traversed' or 'each').

Here 'mapped' is used to turn a value to all non-'Nothing' values in a list:

&gt;&gt;&gt; [Just 3,Nothing,Just 5] &amp; mapped.mapped .~ 0
[Just 0,Nothing,Just 0]

Keep in mind that while 'mapped' is a more powerful setter than 'each', it can't be used as a getter! This won't work (and will fail with a type error):

@
[(1,2),(3,4),(5,6)] '^..' 'mapped' . 'both'
@
-}</span><span>
</span><a name="line-366"></a><span class="hs-identifier">mapped</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679040723"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lens.Micro.Type.html#ASetter"><span class="hs-identifier hs-type">ASetter</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040723"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040724"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040723"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040725"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040724"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040725"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-367"></a><a name="mapped"><a href="Lens.Micro.html#mapped"><span class="hs-identifier">mapped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#sets"><span class="hs-identifier hs-var">sets</span></a><span> </span><span class="hs-identifier hs-var">fmap</span><span>
</span><a name="line-368"></a><span class="hs-pragma">{-# INLINE mapped #-}</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span class="hs-comment">{- |
This is a version of ('%~') which modifies the structure and returns it along with the new value:

&gt;&gt;&gt; (1, 2) &amp; _1 &lt;%~ negate
(-1, (-1, 2))

Simpler type signatures:

@
('&lt;%~') ::             'Lens' s t a b      -&gt; (a -&gt; b) -&gt; s -&gt; (b, t)
('&lt;%~') :: 'Monoid' b =&gt; 'Traversal' s t a b -&gt; (a -&gt; b) -&gt; s -&gt; (b, t)
@

Since it does getting in addition to setting, you can't use it with 'ASetter' (but you can use it with lens and traversals).
-}</span><span>
</span><a name="line-385"></a><span class="hs-special">(</span><span class="hs-operator">&lt;%~</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#LensLike"><span class="hs-identifier hs-type">LensLike</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040719"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040720"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040721"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040722"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040719"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040722"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040719"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040720"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040719"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040721"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span class="hs-special">(</span><a name="%3C%25~"><a href="Lens.Micro.html#%3C%25~"><span class="hs-operator">&lt;%~</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679040757"><a href="#local-6989586621679040757"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679040758"><a href="#local-6989586621679040758"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040757"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679040758"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span class="hs-pragma">{-# INLINE (&lt;%~) #-}</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-comment">{- |
This is a version of ('%~') which modifies the structure and returns it along with the old value:

&gt;&gt;&gt; (1, 2) &amp; _1 &lt;&lt;%~ negate
(1, (-1, 2))

Simpler type signatures:

@
('&lt;&lt;%~') ::             'Lens' s t a b      -&gt; (a -&gt; b) -&gt; s -&gt; (a, t)
('&lt;&lt;%~') :: 'Monoid' a =&gt; 'Traversal' s t a b -&gt; (a -&gt; b) -&gt; s -&gt; (a, t)
@
-}</span><span>
</span><a name="line-402"></a><span class="hs-special">(</span><span class="hs-operator">&lt;&lt;%~</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#LensLike"><span class="hs-identifier hs-type">LensLike</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040715"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040716"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040717"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040715"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040718"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040715"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040718"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040716"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040715"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040717"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span class="hs-special">(</span><a name="%3C%3C%25~"><a href="Lens.Micro.html#%3C%3C%25~"><span class="hs-operator">&lt;&lt;%~</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679040759"><a href="#local-6989586621679040759"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679040760"><a href="#local-6989586621679040760"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040759"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679040761"><a href="#local-6989586621679040761"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040761"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040760"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040761"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-404"></a><span class="hs-pragma">{-# INLINE (&lt;&lt;%~) #-}</span><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span class="hs-comment">{- |
This is a version of ('.~') which modifies the structure and returns it along with the old value:

&gt;&gt;&gt; (1, 2) &amp; _1 &lt;&lt;.~ 0
(1, (0, 2))

Simpler type signatures:

@
('&lt;&lt;.~') ::             'Lens' s t a b      -&gt; b -&gt; s -&gt; (a, t)
('&lt;&lt;.~') :: 'Monoid' a =&gt; 'Traversal' s t a b -&gt; b -&gt; s -&gt; (a, t)
@
-}</span><span>
</span><a name="line-419"></a><span class="hs-special">(</span><span class="hs-operator">&lt;&lt;.~</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#LensLike"><span class="hs-identifier hs-type">LensLike</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040711"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040712"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040713"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040711"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040714"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040714"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040712"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040711"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040713"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span class="hs-special">(</span><a name="%3C%3C.~"><a href="Lens.Micro.html#%3C%3C.~"><span class="hs-operator">&lt;&lt;.~</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679040762"><a href="#local-6989586621679040762"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679040763"><a href="#local-6989586621679040763"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040762"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679040764"><a href="#local-6989586621679040764"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040764"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040763"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span class="hs-pragma">{-# INLINE (&lt;&lt;.~) #-}</span><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span class="hs-comment">-- Getting -----------------------------------------------------------------</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-comment">{- $getters-note

A getter extracts something from a value; in fact, any function is a getter. However, same as with setters, this library uses a special type for getters so that functions like '_1' would be usable both as a setter and a getter. An ordinary function can be turned into a getter with 'to'.

Using a getter is done with ('^.') or 'Lens.Micro.Extras.view' from &quot;Lens.Micro.Extras&quot;:

&gt;&gt;&gt; ('x','y') ^. _1
'x'
&gt;&gt;&gt; view (ix 2) [0..5]
2

Getters can be composed with ('.'):

&gt;&gt;&gt; [(1,2),(3,4),(5,6)] ^. ix 1 . _2
4

A getter always returns exactly 1 element (getters that can return more than one element are called folds and are present in this library as well).
-}</span><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-comment">{- |
('^.') applies a getter to a value; in other words, it gets a value out of a structure using a getter (which can be a lens, traversal, fold, etc.).

Getting 1st field of a tuple:

@
('^.' '_1') :: (a, b) -&gt; a
('^.' '_1') = 'fst'
@

When ('^.') is used with a traversal, it combines all results using the 'Monoid' instance for the resulting type. For instance, for lists it would be simple concatenation:

&gt;&gt;&gt; (&quot;str&quot;,&quot;ing&quot;) ^. each
&quot;string&quot;

The reason for this is that traversals use 'Applicative', and the 'Applicative' instance for 'Const' uses monoid concatenation to combine &#8220;effects&#8221; of 'Const'.

A non-operator version of ('^.') is called @view@, and it's a bit more general than ('^.') (it works in @MonadReader@). If you need the general version, you can get it from &lt;http://hackage.haskell.org/package/microlens-mtl microlens-mtl&gt;; otherwise there's 'Lens.Micro.Extras.view' available in &quot;Lens.Micro.Extras&quot;.
-}</span><span>
</span><a name="line-463"></a><span class="hs-special">(</span><span class="hs-operator">^.</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679040709"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span> </span><a href="#local-6989586621679040710"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040709"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040710"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040710"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-464"></a><a name="local-6989586621679040765"><a href="#local-6989586621679040765"><span class="hs-identifier">s</span></a></a><span> </span><a name="%5E."><a href="Lens.Micro.html#%5E."><span class="hs-operator">^.</span></a></a><span> </span><a name="local-6989586621679040766"><a href="#local-6989586621679040766"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getConst</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040766"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-identifier hs-var">Const</span><span> </span><a href="#local-6989586621679040765"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-465"></a><span class="hs-pragma">{-# INLINE (^.) #-}</span><span>
</span><a name="line-466"></a><span>
</span><a name="line-467"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">^.</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-comment">{- |
'to' creates a getter from any function:

@
a '^.' 'to' f = f a
@

It's most useful in chains, because it lets you mix lenses and ordinary functions. Suppose you have a record which comes from some third-party library and doesn't have any lens accessors. You want to do something like this:

@
value ^. _1 . field . at 2
@

However, @field@ isn't a getter, and you have to do this instead:

@
field (value ^. _1) ^. at 2
@

but now @value@ is in the middle and it's hard to read the resulting code. A variant with 'to' is prettier and more readable:

@
value ^. _1 . to field . at 2
@
-}</span><span>
</span><a name="line-494"></a><span class="hs-identifier">to</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040707"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040708"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#SimpleGetter"><span class="hs-identifier hs-type">SimpleGetter</span></a><span> </span><a href="#local-6989586621679040707"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040708"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-495"></a><a name="to"><a href="Lens.Micro.html#to"><span class="hs-identifier">to</span></a></a><span> </span><a name="local-6989586621679040767"><a href="#local-6989586621679040767"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679040768"><a href="#local-6989586621679040768"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#phantom"><span class="hs-identifier hs-var">phantom</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679040768"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679040767"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-496"></a><span class="hs-pragma">{-# INLINE to #-}</span><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span class="hs-comment">-- Folds -------------------------------------------------------------------</span><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-comment">{- $folds-note

Folds are getters that can return more than one element (or no elements at all). &lt;http://comonad.com/reader/2015/free-monoids-in-haskell/ Except for some rare cases&gt;, a fold is the same thing as @(s -&gt; [a])@; you can use 'folding' to turn any function of type @(s -&gt; f a)@ (where @f@ is 'F.Foldable') into a fold.

Folds can be applied to values by using operators like ('^..'), ('^?'), etc:

&gt;&gt;&gt; (1,2) ^.. both
[1,2]

A nice thing about folds is that you can combine them with ('Data.Monoid.&lt;&gt;') to concatenate their outputs:

&gt;&gt;&gt; (1,2,3) ^.. (_2 &lt;&gt; _1)
[2,1]

When you need to get all elements of the same type in a complicated structure, ('Data.Monoid.&lt;&gt;') can be more helpful than 'each':

&gt;&gt;&gt; ([1,2], 3, [Nothing, Just 4]) ^.. (_1.each &lt;&gt; _2 &lt;&gt; _3.each._Just)
[1,2,3,4]

(Just like setters and getters before, folds can be composed with ('.').)

The ('Data.Monoid.&lt;&gt;') trick works nicely with ('^?'), too. For instance, if you want to get the 9th element of the list, but would be fine with 5th too if the list is too short, you could combine @ix 9@ and @ix 5@:

&gt;&gt;&gt; [0..9] ^? (ix 9 &lt;&gt; ix 5)
Just 9
&gt;&gt;&gt; [0..8] ^? (ix 9 &lt;&gt; ix 5)
Just 5
&gt;&gt;&gt; [0..3] ^? (ix 9 &lt;&gt; ix 5)
Nothing

(Unfortunately, this trick won't help you with setting or modifying.)
-}</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span class="hs-comment">{- |
@s ^.. t@ returns the list of all values that @t@ gets from @s@.

A 'Maybe' contains either 0 or 1 values:

&gt;&gt;&gt; Just 3 ^.. _Just
[3]

Gathering all values in a list of tuples:

&gt;&gt;&gt; [(1,2),(3,4)] ^.. each.each
[1,2,3,4]
-}</span><span>
</span><a name="line-546"></a><span class="hs-special">(</span><span class="hs-operator">^..</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679040705"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Endo</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679040706"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040705"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040706"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679040706"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-547"></a><a name="local-6989586621679040769"><a href="#local-6989586621679040769"><span class="hs-identifier">s</span></a></a><span> </span><a name="%5E.."><a href="Lens.Micro.html#%5E.."><span class="hs-operator">^..</span></a></a><span> </span><a name="local-6989586621679040770"><a href="#local-6989586621679040770"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#toListOf"><span class="hs-identifier hs-var">toListOf</span></a><span> </span><a href="#local-6989586621679040770"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679040769"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-548"></a><span class="hs-pragma">{-# INLINE (^..) #-}</span><span>
</span><a name="line-549"></a><span>
</span><a name="line-550"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">^..</span><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span class="hs-comment">{- |
'toListOf' is a synonym for ('^..').
-}</span><span>
</span><a name="line-555"></a><span class="hs-identifier">toListOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Endo</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679040703"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040704"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040703"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040704"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679040703"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-556"></a><a name="toListOf"><a href="Lens.Micro.html#toListOf"><span class="hs-identifier">toListOf</span></a></a><span> </span><a name="local-6989586621679040771"><a href="#local-6989586621679040771"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#foldrOf"><span class="hs-identifier hs-var">foldrOf</span></a><span> </span><a href="#local-6989586621679040771"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-557"></a><span class="hs-pragma">{-# INLINE toListOf #-}</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-comment">{- |
@s ^? t@ returns the 1st element @t@ returns, or 'Nothing' if @t@ doesn't return anything. It's trivially implemented by passing the 'First' monoid to the getter.

Safe 'head':

&gt;&gt;&gt; [] ^? each
Nothing

&gt;&gt;&gt; [1..3] ^? each
Just 1

Converting 'Either' to 'Maybe':

&gt;&gt;&gt; Left 1 ^? _Right
Nothing

&gt;&gt;&gt; Right 1 ^? _Right
Just 1

A non-operator version of ('^?') is called @preview@, and &#8211; like @view@ &#8211; it's a bit more general than ('^?') (it works in @MonadReader@). If you need the general version, you can get it from &lt;http://hackage.haskell.org/package/microlens-mtl microlens-mtl&gt;; otherwise there's 'Lens.Micro.Extras.preview' available in &quot;Lens.Micro.Extras&quot;.
-}</span><span>
</span><a name="line-580"></a><span class="hs-special">(</span><span class="hs-operator">^?</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679040701"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">First</span><span> </span><a href="#local-6989586621679040702"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040701"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040702"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679040702"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-581"></a><a name="local-6989586621679040772"><a href="#local-6989586621679040772"><span class="hs-identifier">s</span></a></a><span> </span><a name="%5E%3F"><a href="Lens.Micro.html#%5E%3F"><span class="hs-operator">^?</span></a></a><span> </span><a name="local-6989586621679040773"><a href="#local-6989586621679040773"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getFirst</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.Internal.html#foldMapOf"><span class="hs-identifier hs-var">foldMapOf</span></a><span> </span><a href="#local-6989586621679040773"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">First</span><span> </span><a href="Lens.Micro.Internal.html#%23."><span class="hs-operator hs-var">#.</span></a><span> </span><span class="hs-identifier hs-var">Just</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040772"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-582"></a><span class="hs-pragma">{-# INLINE (^?) #-}</span><span>
</span><a name="line-583"></a><span>
</span><a name="line-584"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">^?</span><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span class="hs-comment">{- |
('^?!') is an unsafe variant of ('^?') &#8211; instead of using 'Nothing' to indicate that there were no elements returned, it throws an exception.
-}</span><span>
</span><a name="line-589"></a><span class="hs-special">(</span><span class="hs-operator">^?!</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679040699"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Endo</span><span> </span><a href="#local-6989586621679040700"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040699"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040700"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040700"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-590"></a><a name="local-6989586621679040774"><a href="#local-6989586621679040774"><span class="hs-identifier">s</span></a></a><span> </span><a name="%5E%3F%21"><a href="Lens.Micro.html#%5E%3F%21"><span class="hs-operator">^?!</span></a></a><span> </span><a name="local-6989586621679040775"><a href="#local-6989586621679040775"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#foldrOf"><span class="hs-identifier hs-var">foldrOf</span></a><span> </span><a href="#local-6989586621679040775"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;(^?!): empty Fold&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040774"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-591"></a><span class="hs-pragma">{-# INLINE (^?!) #-}</span><span>
</span><a name="line-592"></a><span>
</span><a name="line-593"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">^?!</span><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span class="hs-comment">{- |
Apply an action to all targets and discard the result (like 'Control.Monad.mapM_' or 'Data.Foldable.traverse_'):

&gt;&gt;&gt; traverseOf_ both putStrLn (&quot;hello&quot;, &quot;world&quot;)
hello
world

Works with anything that allows getting, including lenses and getters (so, anything except for 'ASetter'). Should be faster than 'traverseOf' when you don't need the result.
-}</span><span>
</span><a name="line-604"></a><span class="hs-identifier">traverseOf_</span><span>
</span><a name="line-605"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679040695"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-606"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#Traversed"><span class="hs-identifier hs-type">Traversed</span></a><span> </span><a href="#local-6989586621679040696"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679040695"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040697"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040698"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040698"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040695"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040696"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040697"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040695"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-607"></a><a name="traverseOf_"><a href="Lens.Micro.html#traverseOf_"><span class="hs-identifier">traverseOf_</span></a></a><span> </span><a name="local-6989586621679040805"><a href="#local-6989586621679040805"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679040806"><a href="#local-6989586621679040806"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getTraversed</span><span> </span><a href="Lens.Micro.Internal.html#%23."><span class="hs-operator hs-var">#.</span></a><span> </span><a href="Lens.Micro.Internal.html#foldMapOf"><span class="hs-identifier hs-var">foldMapOf</span></a><span> </span><a href="#local-6989586621679040805"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#Traversed"><span class="hs-identifier hs-var">Traversed</span></a><span> </span><a href="Lens.Micro.Internal.html#%23."><span class="hs-operator hs-var">#.</span></a><span> </span><a href="#local-6989586621679040806"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span class="hs-pragma">{-# INLINE traverseOf_ #-}</span><span>
</span><a name="line-609"></a><span>
</span><a name="line-610"></a><span class="hs-comment">{- |
'traverseOf_' with flipped arguments. Useful if the &#8220;loop body&#8221; is a lambda
or a @do@ block, or in some other cases &#8211; for instance, you can avoid
accidentally using 'Data.Foldable.for_' on a tuple or 'Either' by switching
to @'forOf_' 'each'@. Or you can write custom loops like these:

@
'forOf_' 'both' (a, b) $ \\x -\&gt;
  ...
'forOf_' 'each' [1..10] $ \\x -\&gt;
  ...
'forOf_' ('each' . '_Right') $ \\x -\&gt;
  ...
@
-}</span><span>
</span><a name="line-625"></a><span class="hs-identifier">forOf_</span><span>
</span><a name="line-626"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679040691"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-627"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#Traversed"><span class="hs-identifier hs-type">Traversed</span></a><span> </span><a href="#local-6989586621679040692"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679040691"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040693"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040694"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040693"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040694"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040691"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040692"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040691"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-628"></a><a name="forOf_"><a href="Lens.Micro.html#forOf_"><span class="hs-identifier">forOf_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Lens.Micro.html#traverseOf_"><span class="hs-identifier hs-var">traverseOf_</span></a><span>
</span><a name="line-629"></a><span class="hs-pragma">{-# INLINE forOf_ #-}</span><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span class="hs-comment">{- |
'has' checks whether a getter (any getter, including lenses, traversals, and folds) returns at least 1 value.

Checking whether a list is non-empty:

&gt;&gt;&gt; has each []
False

You can also use it with e.g. '_Left' (and other 0-or-1 traversals) as a replacement for 'Data.Maybe.isNothing', 'Data.Maybe.isJust' and other @isConstructorName@ functions:

&gt;&gt;&gt; has _Left (Left 1)
True
-}</span><span>
</span><a name="line-644"></a><span class="hs-identifier">has</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#Getting"><span class="hs-identifier hs-type">Getting</span></a><span> </span><span class="hs-identifier hs-type">Any</span><span> </span><a href="#local-6989586621679040689"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040690"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040689"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-645"></a><a name="has"><a href="Lens.Micro.html#has"><span class="hs-identifier">has</span></a></a><span> </span><a name="local-6989586621679040807"><a href="#local-6989586621679040807"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getAny</span><span> </span><a href="Lens.Micro.Internal.html#%23."><span class="hs-operator hs-var">#.</span></a><span> </span><a href="Lens.Micro.Internal.html#foldMapOf"><span class="hs-identifier hs-var">foldMapOf</span></a><span> </span><a href="#local-6989586621679040807"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Any</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-646"></a><span class="hs-pragma">{-# INLINE has #-}</span><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-comment">{- |
'folding' creates a fold out of any function that returns a 'F.Foldable' container (for instance, a list):

&gt;&gt;&gt; [1..5] ^.. folding tail
[2,3,4,5]
-}</span><span>
</span><a name="line-654"></a><span class="hs-identifier">folding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">F</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Foldable</span><span> </span><a href="#local-6989586621679040686"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040687"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040686"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040688"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#SimpleFold"><span class="hs-identifier hs-type">SimpleFold</span></a><span> </span><a href="#local-6989586621679040687"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040688"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-655"></a><a name="folding"><a href="Lens.Micro.html#folding"><span class="hs-identifier">folding</span></a></a><span> </span><a name="local-6989586621679040808"><a href="#local-6989586621679040808"><span class="hs-identifier">sfa</span></a></a><span> </span><a name="local-6989586621679040809"><a href="#local-6989586621679040809"><span class="hs-identifier">agb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#phantom"><span class="hs-identifier hs-var">phantom</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">F</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">traverse_</span><span> </span><a href="#local-6989586621679040809"><span class="hs-identifier hs-var">agb</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679040808"><span class="hs-identifier hs-var">sfa</span></a><span>
</span><a name="line-656"></a><span class="hs-pragma">{-# INLINE folding #-}</span><span>
</span><a name="line-657"></a><span>
</span><a name="line-658"></a><span class="hs-comment">-- Lenses ------------------------------------------------------------------</span><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-comment">{- $lenses-note

Lenses are composable &#8220;pointers&#8221; at values inside some bigger structure (e.g. '_1' points at the first element of a tuple). You can use ('^.') to get, ('.~') to set, and ('%~') to modify:

&gt;&gt;&gt; (1,2) ^. _1
1
&gt;&gt;&gt; (1,2) &amp; _1 .~ 3
(3,2)
&gt;&gt;&gt; (1,2) &amp; _1 %~ negate
(-1,2)

To apply a monadic action (or an 'Applicative' action, or even a 'Functor' action) to the pointed value, just apply the lens directly or use 'traverseOf' (or 'traverseOf_' if you don't need the result):

&gt;&gt;&gt; traverseOf_ _1 print (1,2)
1

&gt;&gt;&gt; _1 id (Just 1, 2)
Just (1, 2)
&gt;&gt;&gt; _1 id (Nothing, 2)
Nothing

A 'Lens' can only point at a single value inside a structure (unlike a 'Traversal').

('.') composes lenses (i.e. if a @B@ is a part of @A@, and a @C@ is a part of @B@, then @b.c@ lets you operate on @C@ inside @A@). You can create lenses with 'lens', or you can write them by hand.

There are several ways to get lenses for some datatype:

* They can already be provided by the package, by @microlens@, or by some other package like &lt;http://hackage.haskell.org/package/microlens-platform microlens-platform&gt;.

* They can be provided by some unofficial package (like &lt;http://hackage.haskell.org/package/microlens-aeson microlens-aeson&gt;).

* You can get them by combining already existing lenses.

* You can derive them with Template Haskell (with &lt;http://hackage.haskell.org/package/microlens-th microlens-th&gt;).

* You can write them with 'lens' if you have a setter and a getter. It's a simple and good way.

* You can write them manually (sometimes it looks a bit better than the variant with 'lens', sometimes worse). The generic template is as follows:

@
somelens :: Lens s t a b

-- &#8220;f&#8221; is the &#8220;a -&gt; f b&#8221; function, &#8220;s&#8221; is the structure.
somelens f s =
  let
    a = ...                 -- Extract the value from &#8220;s&#8221;.
    rebuildWith b = ...     -- Write a function which would
                            -- combine &#8220;s&#8221; and modified value
                            -- to produce new structure.
  in
    rebuildWith '&lt;$&gt;' f a     -- Apply the structure-producing
                            -- function to the modified value.
@

Here's the '_1' lens, for instance:

@
'_1' :: 'Lens' (a, x) (b, x) a b
'_1' f (a, x) = (\\b -&gt; (b, x)) '&lt;$&gt;' f a
@

Here's a more complicated lens, which extracts /several/ values from a structure (in a tuple):

@
type Age     = Int
type City    = String
type Country = String

data Person = Person Age City Country

-- This lens lets you access all location-related information about a person.
location :: 'Lens'' Person (City, Country)
location f (Person age city country) =
  (\\(city', country') -&gt; Person age city' country') '&lt;$&gt;' f (city, country)
@

You even can choose to use a lens to present /all/ information contained in the structure (in a different way). Such lenses are called @&lt;http://hackage.haskell.org/package/lens/docs/Control-Lens-Iso.html#t:Iso Iso&gt;@ in lens's terminology. For instance (assuming you don't mind functions that can error out), here's a lens which lets you act on the string representation of a value:

@
string :: (Read a, Show a) =&gt; 'Lens'' a String
string f s = read '&lt;$&gt;' f (show s)
@

Using it to reverse a number:

@
&gt;&gt;&gt; 123 '&amp;' string '%~' reverse
321
@
-}</span><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><span class="hs-comment">{- |
'lens' creates a 'Lens' from a getter and a setter. The resulting lens isn't the most effective one (because of having to traverse the structure twice when modifying), but it shouldn't matter much.

A (partial) lens for list indexing:

@
ix :: Int -&gt; 'Lens'' [a] a
ix i = 'lens' ('!!' i)                                   -- getter
            (\\s b -&gt; take i s ++ b : drop (i+1) s)   -- setter
@

Usage:

@
&gt;&gt;&gt; [1..9] '^.' ix 3
4

&gt;&gt;&gt; [1..9] &amp; ix 3 '%~' negate
[1,2,3,-4,5,6,7,8,9]
@

When getting, the setter is completely unused; when setting, the getter is unused. Both are used only when the value is being modified. For instance, here we define a lens for the 1st element of a list, but instead of a legitimate getter we use 'undefined'. Then we use the resulting lens for /setting/ and it works, which proves that the getter wasn't used:

&gt;&gt;&gt; [1,2,3] &amp; lens undefined (\s b -&gt; b : tail s) .~ 10
[10,2,3]
-}</span><span>
</span><a name="line-777"></a><span class="hs-identifier">lens</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040682"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040683"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040682"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040684"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040685"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Lens"><span class="hs-identifier hs-type">Lens</span></a><span> </span><a href="#local-6989586621679040682"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040685"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040683"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040684"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-778"></a><a name="lens"><a href="Lens.Micro.html#lens"><span class="hs-identifier">lens</span></a></a><span> </span><a name="local-6989586621679040810"><a href="#local-6989586621679040810"><span class="hs-identifier">sa</span></a></a><span> </span><a name="local-6989586621679040811"><a href="#local-6989586621679040811"><span class="hs-identifier">sbt</span></a></a><span> </span><a name="local-6989586621679040812"><a href="#local-6989586621679040812"><span class="hs-identifier">afb</span></a></a><span> </span><a name="local-6989586621679040813"><a href="#local-6989586621679040813"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040811"><span class="hs-identifier hs-var">sbt</span></a><span> </span><a href="#local-6989586621679040813"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679040812"><span class="hs-identifier hs-var">afb</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040810"><span class="hs-identifier hs-var">sa</span></a><span> </span><a href="#local-6989586621679040813"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span class="hs-pragma">{-# INLINE lens #-}</span><span>
</span><a name="line-780"></a><span>
</span><a name="line-781"></a><span class="hs-comment">-- Isos --------------------------------------------------------------------</span><span>
</span><a name="line-782"></a><span>
</span><a name="line-783"></a><span class="hs-comment">{- $isos-note

Isos (or isomorphisms) are lenses that convert a value instead of targeting a part of it; in other words, inside of every list lives a reversed list, inside of every strict @Text@ lives a lazy @Text@, and inside of every @(a, b)@ lives a @(b, a)@. Since an isomorphism doesn't lose any information, it's possible to /reverse/ it and use it in the opposite direction by using @from@ from the lens library:

@
from :: Iso' s a -&gt; Iso' a s
@

However, it's not possible for microlens to export isomorphisms, because their type depends on @&lt;http://hackage.haskell.org/package/profunctors/docs/Data-Profunctor.html#t:Profunctor Profunctor&gt;@, which resides in the &lt;http://hackage.haskell.org/package/profunctors profunctors&gt; library, which is a somewhat huge dependency. So, all isomorphisms included here are lenses instead (and thus you can't use them in the opposite direction).
-}</span><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span class="hs-comment">{- |
'non' lets you &#8220;relabel&#8221; a 'Maybe' by equating 'Nothing' to an arbitrary value (which you can choose):

&gt;&gt;&gt; Just 1 ^. non 0
1

&gt;&gt;&gt; Nothing ^. non 0
0

The most useful thing about 'non' is that relabeling also works in other direction. If you try to 'set' the &#8220;forbidden&#8221; value, it'll be turned to 'Nothing':

&gt;&gt;&gt; Just 1 &amp; non 0 .~ 0
Nothing

Setting anything else works just fine:

&gt;&gt;&gt; Just 1 &amp; non 0 .~ 5
Just 5

Same happens if you try to modify a value:

&gt;&gt;&gt; Just 1 &amp; non 0 %~ subtract 1
Nothing

&gt;&gt;&gt; Just 1 &amp; non 0 .~ (+ 1)
Just 2

'non' is often useful when combined with 'at'. For instance, if you have a map of songs and their playcounts, it makes sense not to store songs with 0 plays in the map; 'non' can act as a filter that wouldn't pass such entries.

Decrease playcount of a song to 0, and it'll be gone:

&gt;&gt;&gt; fromList [(&quot;Soon&quot;,1),(&quot;Yesterday&quot;,3)] &amp; at &quot;Soon&quot; . non 0 %~ subtract 1
fromList [(&quot;Yesterday&quot;,3)]

Try to add a song with 0 plays, and it won't be added:

&gt;&gt;&gt; fromList [(&quot;Yesterday&quot;,3)] &amp; at &quot;Soon&quot; . non 0 .~ 0
fromList [(&quot;Yesterday&quot;,3)]

But it will be added if you set any other number:

&gt;&gt;&gt; fromList [(&quot;Yesterday&quot;,3)] &amp; at &quot;Soon&quot; . non 0 .~ 1
fromList [(&quot;Soon&quot;,1),(&quot;Yesterday&quot;,3)]

'non' is also useful when working with nested maps. Here a nested map is created when it's missing:

&gt;&gt;&gt; Map.empty &amp; at &quot;Dez Mona&quot; . non Map.empty . at &quot;Soon&quot; .~ Just 1
fromList [(&quot;Dez Mona&quot;,fromList [(&quot;Soon&quot;,1)])]

and here it is deleted when its last entry is deleted (notice that 'non' is used twice here):

&gt;&gt;&gt; fromList [(&quot;Dez Mona&quot;,fromList [(&quot;Soon&quot;,1)])] &amp; at &quot;Dez Mona&quot; . non Map.empty . at &quot;Soon&quot; . non 0 %~ subtract 1
fromList []

To understand the last example better, observe the flow of values in it:

* the map goes into @at \&quot;Dez Mona\&quot;@
* the nested map (wrapped into @Just@) goes into @non Map.empty@
* @Just@ is unwrapped and the nested map goes into @at \&quot;Soon\&quot;@
* @Just 1@ is unwrapped by @non 0@

Then the final value &#8211; i.e. 1 &#8211; is modified by @subtract 1@ and the result (which is 0) starts flowing backwards:

* @non 0@ sees the 0 and produces a @Nothing@
* @at \&quot;Soon\&quot;@ sees @Nothing@ and deletes the corresponding value from the map
* the resulting empty map is passed to @non Map.empty@, which sees that it's empty and thus produces @Nothing@
* @at \&quot;Dez Mona\&quot;@ sees @Nothing@ and removes the key from the map
-}</span><span>
</span><a name="line-862"></a><span class="hs-identifier">non</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679040681"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679040681"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679040681"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040681"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-863"></a><a name="non"><a href="Lens.Micro.html#non"><span class="hs-identifier">non</span></a></a><span> </span><a name="local-6989586621679040814"><a href="#local-6989586621679040814"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679040815"><a href="#local-6989586621679040815"><span class="hs-identifier">afb</span></a></a><span> </span><a name="local-6989586621679040816"><a href="#local-6989586621679040816"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040817"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679040815"><span class="hs-identifier hs-var">afb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><a href="#local-6989586621679040814"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679040816"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-864"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679040817"><a href="#local-6989586621679040817"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679040818"><a href="#local-6989586621679040818"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679040814"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679040818"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679040818"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-865"></a><span class="hs-pragma">{-# INLINE non #-}</span><span>
</span><a name="line-866"></a><span>
</span><a name="line-867"></a><span class="hs-comment">-- Traversals --------------------------------------------------------------</span><span>
</span><a name="line-868"></a><span>
</span><a name="line-869"></a><span class="hs-comment">{- $traversals-note

Traversals are like lenses but they can point at multiple values. Use ('^..') to get all values, ('^?') to get the 1st value, ('.~') to set values, ('%~') to modify them. ('.') composes traversals just as it composes lenses. ('^.') can be used with traversals as well, but don't confuse it with ('^..') &#8211; ('^..') gets all traversed values, ('^.') combines traversed values using the ('Data.Monoid.&lt;&gt;') operation (if the values are instances of 'Monoid'; if they aren't, it won't compile). 'traverseOf' and 'traverseOf_' apply an action to all pointed values of a traversal.

Traversals don't differ from lenses when it comes to setting &#8211; you can use usual ('%~') and ('.~') to modify and set values. Getting is a bit different, because you have to decide what to do in the case of multiple values. In particular, you can use these combinators (as well as everything else in the &#8220;Folds&#8221; section):

  * ('^..') gets a list of values
  * ('^?') gets the 1st value (or 'Nothing' if there are no values)
  * ('^?!') gets the 1st value and throws an exception if there are no values

If you are sure that the traversal will traverse at least one value, you can convert it to a lens with 'singular'.

'traversed' is a universal traversal for anything that belongs to the 'Traversable' typeclass. However, in many cases 'each' works as well and is shorter and nicer-looking.
-}</span><span>
</span><a name="line-883"></a><span>
</span><a name="line-884"></a><span class="hs-comment">{- |
Apply an action to all targets (like 'Control.Monad.mapM' or 'Data.Traversable.traverse'):

&gt;&gt;&gt; traverseOf both readFile (&quot;file1&quot;, &quot;file2&quot;)
(&lt;contents of file1&gt;, &lt;contents of file2&gt;)

&gt;&gt;&gt; traverseOf _1 id (Just 1, 2)
Just (1, 2)
&gt;&gt;&gt; traverseOf _1 id (Nothing, 2)
Nothing

You can also just apply the lens\/traversal directly (but 'traverseOf' might be more readable):

&gt;&gt;&gt; both readFile (&quot;file1&quot;, &quot;file2&quot;)
(&lt;contents of file1&gt;, &lt;contents of file2&gt;)

If you don't need the result, use 'traverseOf_'.
-}</span><span>
</span><a name="line-902"></a><span class="hs-identifier">traverseOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#LensLike"><span class="hs-identifier hs-type">LensLike</span></a><span> </span><a href="#local-6989586621679040676"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040677"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040678"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040679"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040680"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040679"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040676"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040680"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040677"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040676"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040678"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-903"></a><a name="traverseOf"><a href="Lens.Micro.html#traverseOf"><span class="hs-identifier">traverseOf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-904"></a><span class="hs-pragma">{-# INLINE traverseOf #-}</span><span>
</span><a name="line-905"></a><span>
</span><a name="line-906"></a><span class="hs-comment">{- |
'traverseOf' with flipped arguments. Useful if the &#8220;loop body&#8221; is a lambda or
a @do@ block.
-}</span><span>
</span><a name="line-910"></a><span class="hs-identifier">forOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#LensLike"><span class="hs-identifier hs-type">LensLike</span></a><span> </span><a href="#local-6989586621679040671"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040672"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040673"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040674"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040675"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040672"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040674"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040671"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040675"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040671"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040673"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-911"></a><a name="forOf"><a href="Lens.Micro.html#forOf"><span class="hs-identifier">forOf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span>
</span><a name="line-912"></a><span class="hs-pragma">{-# INLINE forOf #-}</span><span>
</span><a name="line-913"></a><span>
</span><a name="line-914"></a><span class="hs-comment">{- |
'singular' turns a traversal into a lens that behaves like a single-element traversal:

&gt;&gt;&gt; [1,2,3] ^. signular each
1

&gt;&gt;&gt; [1,2,3] &amp; singular each %~ negate
[-1,2,3]

If there is nothing to return, it'll throw an error:

&gt;&gt;&gt; [] ^. singular each
*** Exception: Lens.Micro.singular: empty traversal

However, it won't fail if you are merely setting the value:

&gt;&gt;&gt; [] &amp; singular each %~ negate
-}</span><span>
</span><a name="line-932"></a><span class="hs-identifier">singular</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span> </span><a href="#local-6989586621679040668"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040669"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040670"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040670"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Lens"><span class="hs-identifier hs-type">Lens</span></a><span> </span><a href="#local-6989586621679040668"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040669"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040670"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040670"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-933"></a><a name="singular"><a href="Lens.Micro.html#singular"><span class="hs-identifier">singular</span></a></a><span> </span><a name="local-6989586621679040819"><a href="#local-6989586621679040819"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679040820"><a href="#local-6989586621679040820"><span class="hs-identifier">afb</span></a></a><span> </span><a name="local-6989586621679040821"><a href="#local-6989586621679040821"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679040824"><span class="hs-identifier hs-var">ins</span></a><span> </span><a href="#local-6989586621679040822"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-934"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679040836"><a href="#local-6989586621679040836"><span class="hs-identifier">w</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679040837"><a href="#local-6989586621679040837"><span class="hs-identifier">ws</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040825"><span class="hs-identifier hs-var">unsafeOuts</span></a><span> </span><a href="#local-6989586621679040822"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><a href="#local-6989586621679040837"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679040820"><span class="hs-identifier hs-var">afb</span></a><span> </span><a href="#local-6989586621679040836"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-935"></a><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040825"><span class="hs-identifier hs-var">unsafeOuts</span></a><span> </span><a href="#local-6989586621679040822"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-936"></a><span>              </span><a href="#local-6989586621679040820"><span class="hs-identifier hs-var">afb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Lens.Micro.singular: empty traversal&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-937"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-938"></a><span>    </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><a name="local-6989586621679040822"><a href="#local-6989586621679040822"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040819"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679040823"><span class="hs-identifier hs-var">sell</span></a><span> </span><a href="#local-6989586621679040821"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-939"></a><span>    </span><a name="local-6989586621679040823"><a href="#local-6989586621679040823"><span class="hs-identifier">sell</span></a></a><span> </span><a name="local-6989586621679040827"><a href="#local-6989586621679040827"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679040827"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-940"></a><span>    </span><a name="local-6989586621679040824"><a href="#local-6989586621679040824"><span class="hs-identifier">ins</span></a></a><span> </span><a name="local-6989586621679040828"><a href="#local-6989586621679040828"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeCoerce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Identity</span><span> </span><a href="#local-6989586621679040829"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679040829"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-941"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier">getConst</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040828"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679040830"><a href="#local-6989586621679040830"><span class="hs-identifier">ra</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Const</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Identity</span><span> </span><a href="#local-6989586621679040830"><span class="hs-identifier hs-var">ra</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-942"></a><span>    </span><a name="local-6989586621679040825"><a href="#local-6989586621679040825"><span class="hs-identifier">unsafeOuts</span></a></a><span> </span><a name="local-6989586621679040831"><a href="#local-6989586621679040831"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#evalState"><span class="hs-identifier hs-var">evalState</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040831"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.html#state"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040826"><span class="hs-identifier hs-var">unconsWithDefault</span></a><span> </span><a href="#local-6989586621679040832"><span class="hs-identifier hs-var">fakeVal</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-943"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679040832"><a href="#local-6989586621679040832"><span class="hs-identifier">fakeVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;unsafeOuts: not enough elements were supplied&quot;</span><span>
</span><a name="line-944"></a><span>    </span><a name="local-6989586621679040826"><a href="#local-6989586621679040826"><span class="hs-identifier">unconsWithDefault</span></a></a><span> </span><a name="local-6989586621679040833"><a href="#local-6989586621679040833"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040833"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-945"></a><span>    </span><span class="hs-identifier">unconsWithDefault</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679040834"><a href="#local-6989586621679040834"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679040835"><a href="#local-6989586621679040835"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040834"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679040835"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-946"></a><span class="hs-pragma">{-# INLINE singular #-}</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span class="hs-comment">{- |
'failing' lets you chain traversals together; if the 1st traversal fails, the 2nd traversal will be used.

&gt;&gt;&gt; ([1,2],[3]) &amp; failing (_1.each) (_2.each) .~ 0
([0,0],[3])

&gt;&gt;&gt; ([],[3]) &amp; failing (_1.each) (_2.each) .~ 0
([],[0])

Note that the resulting traversal won't be valid unless either both traversals don't touch each others' elements, or both traversals return exactly the same results. To see an example of how 'failing' can generate invalid traversals, see &lt;http://stackoverflow.com/questions/27138856/why-does-failing-from-lens-produce-invalid-traversals this Stackoverflow question&gt;.
-}</span><span>
</span><a name="line-959"></a><span class="hs-identifier">failing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span> </span><a href="#local-6989586621679040664"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040665"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040666"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040667"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span> </span><a href="#local-6989586621679040664"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040665"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040666"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040667"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span> </span><a href="#local-6989586621679040664"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040665"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040666"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040667"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-960"></a><a name="failing"><a href="Lens.Micro.html#failing"><span class="hs-identifier">failing</span></a></a><span> </span><a name="local-6989586621679040838"><a href="#local-6989586621679040838"><span class="hs-identifier">left</span></a></a><span> </span><a name="local-6989586621679040839"><a href="#local-6989586621679040839"><span class="hs-identifier">right</span></a></a><span> </span><a name="local-6989586621679040840"><a href="#local-6989586621679040840"><span class="hs-identifier">afb</span></a></a><span> </span><a name="local-6989586621679040841"><a href="#local-6989586621679040841"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679040844"><span class="hs-identifier hs-var">pins</span></a><span> </span><a href="#local-6989586621679040842"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-961"></a><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040839"><span class="hs-identifier hs-var">right</span></a><span> </span><a href="#local-6989586621679040840"><span class="hs-identifier hs-var">afb</span></a><span> </span><a href="#local-6989586621679040841"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-962"></a><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040842"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679040840"><span class="hs-identifier hs-var">afb</span></a><span>
</span><a name="line-963"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-964"></a><span>    </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><a name="local-6989586621679040842"><a href="#local-6989586621679040842"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040838"><span class="hs-identifier hs-var">left</span></a><span> </span><a href="#local-6989586621679040843"><span class="hs-identifier hs-var">sell</span></a><span> </span><a href="#local-6989586621679040841"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-965"></a><span>    </span><a name="local-6989586621679040843"><a href="#local-6989586621679040843"><span class="hs-identifier">sell</span></a></a><span> </span><a name="local-6989586621679040845"><a href="#local-6989586621679040845"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679040845"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-966"></a><span>    </span><a name="local-6989586621679040844"><a href="#local-6989586621679040844"><span class="hs-identifier">pins</span></a></a><span> </span><a name="local-6989586621679040846"><a href="#local-6989586621679040846"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getConst</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040846"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679040847"><a href="#local-6989586621679040847"><span class="hs-identifier">ra</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Const</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Identity</span><span> </span><a href="#local-6989586621679040847"><span class="hs-identifier hs-var">ra</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">5</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">failing</span><span class="hs-special">`</span><span>
</span><a name="line-969"></a><span>
</span><a name="line-970"></a><span class="hs-comment">{- |
'filtered' is a traversal that filters elements &#8220;passing&#8221; through it:

&gt;&gt;&gt; (1,2,3,4) ^.. each
[1,2,3,4]

&gt;&gt;&gt; (1,2,3,4) ^.. each . filtered even
[2,4]

It also can be used to modify elements selectively:

&gt;&gt;&gt; (1,2,3,4) &amp; each . filtered even %~ (*100)
(1,200,3,400)

The implementation of 'filtered' is very simple. Consider this traversal, which always &#8220;traverses&#8221; just the value it's given:

@
id :: 'Traversal'' a a
id f s = f s
@

And this traversal, which traverses nothing (in other words, /doesn't/ traverse the value it's given):

@
ignored :: 'Traversal'' a a
ignored f s = 'pure' s
@

And now combine them into a traversal that conditionally traverses the value it's given, and you get 'filtered':

@
filtered :: (a -&gt; Bool) -&gt; 'Traversal'' a a
filtered p s = if p s then f s else 'pure' s
@

By the way, note that 'filtered' can generate illegal traversals &#8211; sometimes this can bite you. In particular, an optimisation that should be safe becomes unsafe. (To the best of my knowledge, this optimisation never happens automatically. If you just use 'filtered' to modify/view something, you're safe. If you don't define any traversals that use 'filtered', you're safe too.)

Let's use @evens@ as an example:

@
evens = 'filtered' 'even'
@

If @evens@ was a legal traversal, you'd be able to fuse several applications of @evens@ like this:

@
'over' evens f '.' 'over' evens g = 'over' evens (f '.' g)
@

Unfortunately, in case of @evens@ this isn't a correct optimisation:

  * the left-side variant applies @g@ to all even numbers, and then applies @f@ to all even numbers that are left after @f@ (because @f@ might've turned some even numbers into odd ones)

  * the right-side variant applies @f@ and @g@ to all even numbers

Of course, when you are careful and know what you're doing, you won't try to make such an optimisation. However, if you export an illegal traversal created with 'filtered' and someone tries to use it, they might mistakenly assume that it's legal, do the optimisation, and silently get an incorrect result.

If you are using 'filtered' with some another traversal that doesn't overlap with -whatever the predicate checks-, the resulting traversal will be legal. For instance, here the predicate looks at the 1st element of a tuple, but the resulting traversal only gives you access to the 2nd:

@
pairedWithEvens :: 'Traversal' [(Int, a)] [(Int, b)] a b
pairedWithEvens = 'each' '.' 'filtered' ('even' '.' 'fst') '.' '_2'
@

Since you can't do anything with the 1st components through this traversal, the following holds for any @f@ and @g@:

@
'over' pairedWithEvens f '.' 'over' pairedWithEvens g = 'over' pairedWithEvens (f '.' g)
@
-}</span><span>
</span><a name="line-1040"></a><span class="hs-identifier">filtered</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040663"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.Type.html#Traversal%27"><span class="hs-identifier hs-type">Traversal'</span></a><span> </span><a href="#local-6989586621679040663"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040663"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1041"></a><a name="filtered"><a href="Lens.Micro.html#filtered"><span class="hs-identifier">filtered</span></a></a><span> </span><a name="local-6989586621679040848"><a href="#local-6989586621679040848"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679040849"><a href="#local-6989586621679040849"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679040850"><a href="#local-6989586621679040850"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679040848"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679040850"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679040849"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040850"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679040850"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1042"></a><span class="hs-pragma">{-# INLINE filtered #-}</span><span>
</span><a name="line-1043"></a><span>
</span><a name="line-1044"></a><span class="hs-comment">{- |
'both' traverses both fields of a tuple. Unlike @&lt;http://hackage.haskell.org/package/lens/docs/Control-Lens-Traversal.html#v:both both&gt;@ from lens, it only works for pairs &#8211; not for triples or 'Either'.

&gt;&gt;&gt; (&quot;str&quot;,&quot;ing&quot;) ^. both
&quot;string&quot;

&gt;&gt;&gt; (&quot;str&quot;,&quot;ing&quot;) &amp; both %~ reverse
(&quot;rts&quot;,&quot;gni&quot;)
-}</span><span>
</span><a name="line-1053"></a><span class="hs-identifier">both</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040661"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040661"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040662"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040662"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040661"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040662"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1054"></a><a name="both"><a href="Lens.Micro.html#both"><span class="hs-identifier">both</span></a></a><span> </span><a name="local-6989586621679040851"><a href="#local-6989586621679040851"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621679040852"><a href="#local-6989586621679040852"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679040853"><a href="#local-6989586621679040853"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040851"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040852"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040851"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040853"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1055"></a><span class="hs-pragma">{-# INLINE both #-}</span><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><span class="hs-comment">{- |
'_head' traverses the 1st element of something (usually a list, but can also be a @Seq@, etc):

&gt;&gt;&gt; [1..5] ^? _head
Just 1

It can be used to modify too, as in this example where the 1st letter of a sentence is capitalised:

&gt;&gt;&gt; &quot;mary had a little lamb.&quot; &amp; _head %~ toTitle
&quot;Mary had a little lamb.&quot;

The reason it's a traversal and not a lens is that there's nothing to traverse when the list is empty:

&gt;&gt;&gt; [] ^? _head
Nothing

This package only lets you use '_head' on lists, but if you use &lt;http://hackage.haskell.org/package/microlens-ghc microlens-ghc&gt; you get instances for @ByteString@ and @Seq@, and if you use &lt;http://hackage.haskell.org/package/microlens-platform microlens-platform&gt; you additionally get instances for @Text@ and @Vector@.
-}</span><span>
</span><a name="line-1075"></a><span class="hs-identifier">_head</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Internal.html#Cons"><span class="hs-identifier hs-type">Cons</span></a><span> </span><a href="#local-6989586621679040659"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040659"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040660"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040660"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lens.Micro.Type.html#Traversal%27"><span class="hs-identifier hs-type">Traversal'</span></a><span> </span><a href="#local-6989586621679040659"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040660"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1076"></a><a name="_head"><a href="Lens.Micro.html#_head"><span class="hs-identifier">_head</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#_Cons"><span class="hs-identifier hs-var">_Cons</span></a><span class="hs-operator hs-var">.</span><a href="Lens.Micro.Internal.html#_1"><span class="hs-identifier hs-var">_1</span></a><span>
</span><a name="line-1077"></a><span class="hs-pragma">{-# INLINE _head #-}</span><span>
</span><a name="line-1078"></a><span>
</span><a name="line-1079"></a><span class="hs-comment">{- |
'_tail' gives you access to the tail of a list (or @Seq@, etc):

&gt;&gt;&gt; [1..5] ^? _tail
Just [2,3,4,5]

You can modify the tail as well:

&gt;&gt;&gt; [4,1,2,3] &amp; _tail %~ reverse
[4,3,2,1]

Since lists are monoids, you can use '_tail' with plain ('^.') (and then it'll return an empty list if you give it an empty list):

&gt;&gt;&gt; [1..5] ^. _tail
[2,3,4,5]

&gt;&gt;&gt; [] ^. _tail
[]

If you want to traverse each /element/ of the tail, use '_tail' with 'each':

&gt;&gt;&gt; &quot;I HATE CAPS.&quot; &amp; _tail.each %~ toLower
&quot;I hate caps.&quot;

This package only lets you use '_tail' on lists, but if you use &lt;http://hackage.haskell.org/package/microlens-ghc microlens-ghc&gt; you get instances for @ByteString@ and @Seq@, and if you use &lt;http://hackage.haskell.org/package/microlens-platform microlens-platform&gt; you additionally get instances for @Text@ and @Vector@.
-}</span><span>
</span><a name="line-1105"></a><span class="hs-identifier">_tail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Internal.html#Cons"><span class="hs-identifier hs-type">Cons</span></a><span> </span><a href="#local-6989586621679040657"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040657"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040658"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040658"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lens.Micro.Type.html#Traversal%27"><span class="hs-identifier hs-type">Traversal'</span></a><span> </span><a href="#local-6989586621679040657"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040657"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-1106"></a><a name="_tail"><a href="Lens.Micro.html#_tail"><span class="hs-identifier">_tail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#_Cons"><span class="hs-identifier hs-var">_Cons</span></a><span class="hs-operator hs-var">.</span><a href="Lens.Micro.Internal.html#_2"><span class="hs-identifier hs-var">_2</span></a><span>
</span><a name="line-1107"></a><span class="hs-pragma">{-# INLINE _tail #-}</span><span>
</span><a name="line-1108"></a><span>
</span><a name="line-1109"></a><span class="hs-comment">{- |
'_init' gives you access to all-but-the-last elements of the list:

&gt;&gt;&gt; &quot;Hello.&quot; ^. _init
&quot;Hello&quot;

See documentation for '_tail', as '_init' and '_tail' are pretty similar.
-}</span><span>
</span><a name="line-1117"></a><span class="hs-identifier">_init</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Internal.html#Snoc"><span class="hs-identifier hs-type">Snoc</span></a><span> </span><a href="#local-6989586621679040655"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040655"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040656"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040656"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lens.Micro.Type.html#Traversal%27"><span class="hs-identifier hs-type">Traversal'</span></a><span> </span><a href="#local-6989586621679040655"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040655"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-1118"></a><a name="_init"><a href="Lens.Micro.html#_init"><span class="hs-identifier">_init</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#_Snoc"><span class="hs-identifier hs-var">_Snoc</span></a><span class="hs-operator hs-var">.</span><a href="Lens.Micro.Internal.html#_1"><span class="hs-identifier hs-var">_1</span></a><span>
</span><a name="line-1119"></a><span class="hs-pragma">{-# INLINE _init #-}</span><span>
</span><a name="line-1120"></a><span>
</span><a name="line-1121"></a><span class="hs-comment">{- |
'_last' gives you access to the last element of the list:

&gt;&gt;&gt; &quot;Hello.&quot; ^? _last
'.'

See documentation for '_head', as '_last' and '_head' are pretty similar.
-}</span><span>
</span><a name="line-1129"></a><span class="hs-identifier">_last</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Internal.html#Snoc"><span class="hs-identifier hs-type">Snoc</span></a><span> </span><a href="#local-6989586621679040653"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040653"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040654"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040654"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Lens.Micro.Type.html#Traversal%27"><span class="hs-identifier hs-type">Traversal'</span></a><span> </span><a href="#local-6989586621679040653"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040654"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1130"></a><a name="_last"><a href="Lens.Micro.html#_last"><span class="hs-identifier">_last</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.Internal.html#_Snoc"><span class="hs-identifier hs-var">_Snoc</span></a><span class="hs-operator hs-var">.</span><a href="Lens.Micro.Internal.html#_2"><span class="hs-identifier hs-var">_2</span></a><span>
</span><a name="line-1131"></a><span class="hs-pragma">{-# INLINE _last #-}</span><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><span>
</span><a name="line-1134"></a><span class="hs-comment">{- |
This generalizes 'Data.Traversable.mapAccumL' to an arbitrary 'Traversal'. (Note that it doesn't work on folds, only traversals.)

@
'mapAccumL' &#8801; 'mapAccumLOf' 'traverse'
@
-}</span><span>
</span><a name="line-1141"></a><span class="hs-identifier">mapAccumLOf</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#LensLike"><span class="hs-identifier hs-type">LensLike</span></a><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#State"><span class="hs-identifier hs-type">State</span></a><span> </span><a href="#local-6989586621679040648"><span class="hs-identifier hs-type">acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040649"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040650"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679040651"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040652"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040648"><span class="hs-identifier hs-type">acc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040651"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040648"><span class="hs-identifier hs-type">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040652"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040648"><span class="hs-identifier hs-type">acc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040649"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040648"><span class="hs-identifier hs-type">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040650"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1142"></a><a name="mapAccumLOf"><a href="Lens.Micro.html#mapAccumLOf"><span class="hs-identifier">mapAccumLOf</span></a></a><span> </span><a name="local-6989586621679040854"><a href="#local-6989586621679040854"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679040855"><a href="#local-6989586621679040855"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679040856"><a href="#local-6989586621679040856"><span class="hs-identifier">acc0</span></a></a><span> </span><a name="local-6989586621679040857"><a href="#local-6989586621679040857"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">swap</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#runState"><span class="hs-identifier hs-var">runState</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040854"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679040858"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679040857"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040856"><span class="hs-identifier hs-var">acc0</span></a><span class="hs-special">)</span><span>
</span><a name="line-1143"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1144"></a><span>    </span><a name="local-6989586621679040858"><a href="#local-6989586621679040858"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621679040859"><a href="#local-6989586621679040859"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#state"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679040860"><a href="#local-6989586621679040860"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">swap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040855"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040860"><span class="hs-identifier hs-var">acc</span></a><span> </span><a href="#local-6989586621679040859"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1145"></a><span class="hs-pragma">{-# INLINE mapAccumLOf #-}</span><span>
</span><a name="line-1146"></a><span>
</span><a name="line-1147"></a><span class="hs-comment">-- Prisms ------------------------------------------------------------------</span><span>
</span><a name="line-1148"></a><span>
</span><a name="line-1149"></a><span class="hs-comment">{- $prisms-note

Prisms are traversals that always target 0 or 1 values. Moreover, it's possible to /reverse/ a prism, using it to construct a structure instead of peeking into it. Here's an example from the lens library:

@
&gt;&gt;&gt; over _Left (+1) (Left 2)
Left 3

&gt;&gt;&gt; _Left # 5
Left 5
@

However, it's not possible for microlens to export prisms, because their type depends on @&lt;http://hackage.haskell.org/package/profunctors/docs/Data-Profunctor.html#t:Choice Choice&gt;@ from &lt;http://hackage.haskell.org/package/profunctors profunctors&gt;. So, all prisms included here are traversals instead (and you can't reverse them).
-}</span><span>
</span><a name="line-1163"></a><span>
</span><a name="line-1164"></a><span class="hs-comment">{- |
'_Left' targets the value contained in an 'Either', provided it's a 'Left'.

Gathering all @Left@s in a structure (like the 'Data.Either.lefts' function, but not necessarily just for lists):

&gt;&gt;&gt; [Left 1, Right 'c', Left 3] ^.. each._Just
[1,3]

Checking whether an 'Either' is a 'Left' (like 'Data.Either.isLeft'):

&gt;&gt;&gt; has _Left (Left 1)
True

&gt;&gt;&gt; has _Left (Right 1)
False

Extracting a value (if you're sure it's a 'Left'):

&gt;&gt;&gt; Left 1 ^?! _Left
1

Mapping over all 'Left's:

&gt;&gt;&gt; (each._Left %~ map toUpper) [Left &quot;foo&quot;, Right &quot;bar&quot;]
[Left &quot;FOO&quot;,Right &quot;bar&quot;]

Implementation:

@
'_Left' f (Left a)  = 'Left' '&lt;$&gt;' f a
'_Left' _ (Right b) = 'pure' ('Right' b)
@
-}</span><span>
</span><a name="line-1197"></a><span class="hs-identifier">_Left</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679040645"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040646"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679040647"><span class="hs-identifier hs-type">a'</span></a><span> </span><a href="#local-6989586621679040646"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040645"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040647"><span class="hs-identifier hs-type">a'</span></a><span>
</span><a name="line-1198"></a><a name="_Left"><a href="Lens.Micro.html#_Left"><span class="hs-identifier">_Left</span></a></a><span> </span><a name="local-6989586621679040861"><a href="#local-6989586621679040861"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679040862"><a href="#local-6989586621679040862"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679040861"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040862"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1199"></a><span class="hs-identifier">_Left</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679040863"><a href="#local-6989586621679040863"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679040863"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1200"></a><span class="hs-pragma">{-# INLINE _Left #-}</span><span>
</span><a name="line-1201"></a><span>
</span><a name="line-1202"></a><span class="hs-comment">{- |
'_Right' targets the value contained in an 'Either', provided it's a 'Right'.

See documentation for '_Left'.
-}</span><span>
</span><a name="line-1207"></a><span class="hs-identifier">_Right</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679040642"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040643"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679040642"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040644"><span class="hs-identifier hs-type">b'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040643"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679040644"><span class="hs-identifier hs-type">b'</span></a><span>
</span><a name="line-1208"></a><a name="_Right"><a href="Lens.Micro.html#_Right"><span class="hs-identifier">_Right</span></a></a><span> </span><a name="local-6989586621679040864"><a href="#local-6989586621679040864"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679040865"><a href="#local-6989586621679040865"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679040864"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040865"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1209"></a><span class="hs-identifier">_Right</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679040866"><a href="#local-6989586621679040866"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679040866"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1210"></a><span class="hs-pragma">{-# INLINE _Right #-}</span><span>
</span><a name="line-1211"></a><span>
</span><a name="line-1212"></a><span class="hs-comment">{- |
'_Just' targets the value contained in a 'Maybe', provided it's a 'Just'.

See documentation for '_Left' (as these 2 are pretty similar). In particular, it can be used to write these:

  * Unsafely extracting a value from a 'Just':

    @
    'Data.Maybe.fromJust' = ('^?!' '_Just')
    @

  * Checking whether a value is a 'Just':

    @
    'Data.Maybe.isJust' = 'has' '_Just'
    @

  * Converting a 'Maybe' to a list (empty or consisting of a single element):

    @
    'Data.Maybe.maybeToList' = ('^..' '_Just')
    @

  * Gathering all 'Just's in a list:

    @
    'Data.Maybe.catMaybes' = ('^..' 'each' '.' '_Just')
    @
-}</span><span>
</span><a name="line-1241"></a><span class="hs-identifier">_Just</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#Traversal"><span class="hs-identifier hs-type">Traversal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679040640"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679040641"><span class="hs-identifier hs-type">a'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040640"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040641"><span class="hs-identifier hs-type">a'</span></a><span>
</span><a name="line-1242"></a><a name="_Just"><a href="Lens.Micro.html#_Just"><span class="hs-identifier">_Just</span></a></a><span> </span><a name="local-6989586621679040867"><a href="#local-6989586621679040867"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679040868"><a href="#local-6989586621679040868"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679040867"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040868"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1243"></a><span class="hs-identifier">_Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1244"></a><span class="hs-pragma">{-# INLINE _Just #-}</span><span>
</span><a name="line-1245"></a><span>
</span><a name="line-1246"></a><span class="hs-comment">{- |
'_Nothing' targets a @()@ if the 'Maybe' is a 'Nothing', and doesn't target anything otherwise:

&gt;&gt;&gt; Just 1 ^.. _Nothing
[]

&gt;&gt;&gt; Nothing ^.. _Nothing
[()]

It's not particularly useful (unless you want to use @'has' '_Nothing'@ as a replacement for 'Data.Maybe.isNothing'), and provided mainly for consistency.

Implementation:

@
'_Nothing' f Nothing = 'const' 'Nothing' '&lt;$&gt;' f ()
'_Nothing' _ j       = 'pure' j
@
-}</span><span>
</span><a name="line-1264"></a><span class="hs-identifier">_Nothing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.Type.html#Traversal%27"><span class="hs-identifier hs-type">Traversal'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679040639"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1265"></a><a name="_Nothing"><a href="Lens.Micro.html#_Nothing"><span class="hs-identifier">_Nothing</span></a></a><span> </span><a name="local-6989586621679040869"><a href="#local-6989586621679040869"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679040869"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1266"></a><span class="hs-identifier">_Nothing</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679040870"><a href="#local-6989586621679040870"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679040870"><span class="hs-identifier hs-var">j</span></a><span>
</span><a name="line-1267"></a><span class="hs-pragma">{-# INLINE _Nothing #-}</span><span>
</span><a name="line-1268"></a><span>
</span><a name="line-1269"></a><span class="hs-comment">-- Some of the guts of lens</span><span>
</span><a name="line-1270"></a><span>
</span><a name="line-1271"></a><span class="hs-keyword">newtype</span><span> </span><a name="Traversed"><a href="Lens.Micro.html#Traversed"><span class="hs-identifier">Traversed</span></a></a><span> </span><a name="local-6989586621679040630"><a href="#local-6989586621679040630"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679040631"><a href="#local-6989586621679040631"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Traversed"><a href="Lens.Micro.html#Traversed"><span class="hs-identifier">Traversed</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getTraversed"><a href="Lens.Micro.html#getTraversed"><span class="hs-identifier">getTraversed</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679040631"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040630"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1272"></a><span>
</span><a name="line-1273"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-6989586621679040914"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#Traversed"><span class="hs-identifier hs-type">Traversed</span></a><span> </span><a href="#local-6989586621679040915"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040914"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1274"></a><span>  </span><a name="local-3458764513820541442"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#Traversed"><span class="hs-identifier hs-var">Traversed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Lens.Micro.Traversed: value used&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1275"></a><span>  </span><span class="hs-pragma">{-# INLINE mempty #-}</span><span>
</span><a name="line-1276"></a><span>  </span><a href="Lens.Micro.html#Traversed"><span class="hs-identifier hs-var">Traversed</span></a><span> </span><a name="local-6989586621679040916"><a href="#local-6989586621679040916"><span class="hs-identifier">ma</span></a></a><span> </span><span class="hs-special">`</span><a name="local-3458764513820541443"><span class="hs-identifier">mappend</span></a><span class="hs-special">`</span><span> </span><a href="Lens.Micro.html#Traversed"><span class="hs-identifier hs-var">Traversed</span></a><span> </span><a name="local-6989586621679040917"><a href="#local-6989586621679040917"><span class="hs-identifier">mb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#Traversed"><span class="hs-identifier hs-var">Traversed</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040916"><span class="hs-identifier hs-var">ma</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-6989586621679040917"><span class="hs-identifier hs-var">mb</span></a><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>  </span><span class="hs-pragma">{-# INLINE mappend #-}</span><span>
</span><a name="line-1278"></a><span>
</span><a name="line-1279"></a><span class="hs-keyword">newtype</span><span> </span><a name="Bazaar"><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier">Bazaar</span></a></a><span> </span><a name="local-6989586621679040626"><a href="#local-6989586621679040626"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679040627"><a href="#local-6989586621679040627"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679040628"><a href="#local-6989586621679040628"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Bazaar"><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier">Bazaar</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679040629"><a href="#local-6989586621679040629"><span class="hs-identifier">f</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-6989586621679040629"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040626"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040629"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040627"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040629"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679040628"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1280"></a><span>
</span><a name="line-1281"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-type">Bazaar</span></a><span> </span><a href="#local-6989586621679040910"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040911"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1282"></a><span>  </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-6989586621679040912"><a href="#local-6989586621679040912"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><a name="local-6989586621679040913"><a href="#local-6989586621679040913"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621679040912"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679040913"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-1283"></a><span>  </span><span class="hs-pragma">{-# INLINE fmap #-}</span><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-type">Bazaar</span></a><span> </span><a href="#local-6989586621679040904"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679040905"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1286"></a><span>  </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621679040906"><a href="#local-6989586621679040906"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679040906"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1287"></a><span>  </span><span class="hs-pragma">{-# INLINE pure #-}</span><span>
</span><a name="line-1288"></a><span>  </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><a name="local-6989586621679040907"><a href="#local-6989586621679040907"><span class="hs-identifier">mf</span></a></a><span> </span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span> </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><a name="local-6989586621679040908"><a href="#local-6989586621679040908"><span class="hs-identifier">ma</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#Bazaar"><span class="hs-identifier hs-var">Bazaar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679040909"><a href="#local-6989586621679040909"><span class="hs-identifier">afb</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040907"><span class="hs-identifier hs-var">mf</span></a><span> </span><a href="#local-6989586621679040909"><span class="hs-identifier hs-var">afb</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621679040908"><span class="hs-identifier hs-var">ma</span></a><span> </span><a href="#local-6989586621679040909"><span class="hs-identifier hs-var">afb</span></a><span>
</span><a name="line-1289"></a><span>  </span><span class="hs-pragma">{-# INLINE (&lt;*&gt;) #-}</span><span>
</span><a name="line-1290"></a><span>
</span><a name="line-1291"></a><span class="hs-comment">-- A reimplementation of State</span><span>
</span><a name="line-1292"></a><span>
</span><a name="line-1293"></a><span class="hs-keyword">newtype</span><span> </span><a name="StateT"><a href="Lens.Micro.html#StateT"><span class="hs-identifier">StateT</span></a></a><span> </span><a name="local-6989586621679040623"><a href="#local-6989586621679040623"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679040624"><a href="#local-6989586621679040624"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679040625"><a href="#local-6989586621679040625"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="StateT"><a href="Lens.Micro.html#StateT"><span class="hs-identifier">StateT</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="runStateT"><a href="Lens.Micro.html#runStateT"><span class="hs-identifier">runStateT</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679040623"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040624"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040625"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040623"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1294"></a><span>
</span><a name="line-1295"></a><span class="hs-keyword">type</span><span> </span><a name="State"><a href="Lens.Micro.html#State"><span class="hs-identifier">State</span></a></a><span> </span><a name="local-6989586621679040622"><a href="#local-6989586621679040622"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-type">StateT</span></a><span> </span><a href="#local-6989586621679040622"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Identity</span><span>
</span><a name="line-1296"></a><span>
</span><a name="line-1297"></a><span class="hs-identifier">state</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679040636"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040637"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040638"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040637"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-type">StateT</span></a><span> </span><a href="#local-6989586621679040637"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040636"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040638"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1298"></a><a name="state"><a href="Lens.Micro.html#state"><span class="hs-identifier">state</span></a></a><span> </span><a name="local-6989586621679040871"><a href="#local-6989586621679040871"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679040871"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1299"></a><span class="hs-pragma">{-# INLINE state #-}</span><span>
</span><a name="line-1300"></a><span>
</span><a name="line-1301"></a><span class="hs-identifier">evalState</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.html#State"><span class="hs-identifier hs-type">State</span></a><span> </span><a href="#local-6989586621679040634"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040635"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040634"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040635"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1302"></a><a name="evalState"><a href="Lens.Micro.html#evalState"><span class="hs-identifier">evalState</span></a></a><span> </span><a name="local-6989586621679040872"><a href="#local-6989586621679040872"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679040873"><a href="#local-6989586621679040873"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#runState"><span class="hs-identifier hs-var">runState</span></a><span> </span><a href="#local-6989586621679040872"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679040873"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1303"></a><span class="hs-pragma">{-# INLINE evalState #-}</span><span>
</span><a name="line-1304"></a><span>
</span><a name="line-1305"></a><span class="hs-identifier">runState</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Lens.Micro.html#State"><span class="hs-identifier hs-type">State</span></a><span> </span><a href="#local-6989586621679040632"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040633"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040632"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040633"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040632"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1306"></a><a name="runState"><a href="Lens.Micro.html#runState"><span class="hs-identifier">runState</span></a></a><span> </span><a name="local-6989586621679040874"><a href="#local-6989586621679040874"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">runStateT</span><span> </span><a href="#local-6989586621679040874"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1307"></a><span class="hs-pragma">{-# INLINE runState #-}</span><span>
</span><a name="line-1308"></a><span>
</span><a name="line-1309"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679040897"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-type">StateT</span></a><span> </span><a href="#local-6989586621679040898"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040897"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1310"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-6989586621679040899"><a href="#local-6989586621679040899"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679040900"><a href="#local-6989586621679040900"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679040901"><a href="#local-6989586621679040901"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1311"></a><span>        </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621679040902"><a href="#local-6989586621679040902"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679040903"><a href="#local-6989586621679040903"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040899"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040902"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040903"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">runStateT</span><span> </span><a href="#local-6989586621679040900"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679040901"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1312"></a><span>    </span><span class="hs-pragma">{-# INLINE fmap #-}</span><span>
</span><a name="line-1313"></a><span>
</span><a name="line-1314"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679040886"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679040886"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-type">StateT</span></a><span> </span><a href="#local-6989586621679040887"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040886"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1315"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621679040888"><a href="#local-6989586621679040888"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679040889"><a href="#local-6989586621679040889"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040888"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040889"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1316"></a><span>    </span><span class="hs-pragma">{-# INLINE pure #-}</span><span>
</span><a name="line-1317"></a><span>    </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><a name="local-6989586621679040890"><a href="#local-6989586621679040890"><span class="hs-identifier">mf</span></a></a><span> </span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><a name="local-6989586621679040891"><a href="#local-6989586621679040891"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679040892"><a href="#local-6989586621679040892"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1318"></a><span>        </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621679040893"><a href="#local-6989586621679040893"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679040894"><a href="#local-6989586621679040894"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679040890"><span class="hs-identifier hs-var">mf</span></a><span> </span><a href="#local-6989586621679040892"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1319"></a><span>        </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621679040895"><a href="#local-6989586621679040895"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679040896"><a href="#local-6989586621679040896"><span class="hs-identifier">s''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679040891"><span class="hs-identifier hs-var">mx</span></a><span> </span><a href="#local-6989586621679040894"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-1320"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040893"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040895"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679040896"><span class="hs-identifier hs-var">s''</span></a><span class="hs-special">)</span><span>
</span><a name="line-1321"></a><span>    </span><span class="hs-pragma">{-# INLINE (&lt;*&gt;) #-}</span><span>
</span><a name="line-1322"></a><span>
</span><a name="line-1323"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679040878"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-type">StateT</span></a><span> </span><a href="#local-6989586621679040879"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040878"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1324"></a><span class="hs-cpp">#if !(MIN_VERSION_base(4,8,0))</span><span>
</span><a name="line-1325"></a><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">StateT</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span>
</span><a name="line-1326"></a><span>    </span><span class="hs-pragma">{-# INLINE return #-}</span><span>
</span><a name="line-1327"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1328"></a><span>    </span><a name="local-6989586621679040880"><a href="#local-6989586621679040880"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621679040881"><a href="#local-6989586621679040881"><span class="hs-identifier">k</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679040882"><a href="#local-6989586621679040882"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1329"></a><span>        </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621679040883"><a href="#local-6989586621679040883"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679040884"><a href="#local-6989586621679040884"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">runStateT</span><span> </span><a href="#local-6989586621679040880"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679040882"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1330"></a><span>        </span><span class="hs-identifier">runStateT</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040881"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679040883"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040884"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-1331"></a><span>    </span><span class="hs-pragma">{-# INLINE (&gt;&gt;=) #-}</span><span>
</span><a name="line-1332"></a><span>    </span><a name="local-3458764513820541098"><span class="hs-identifier">fail</span></a><span> </span><a name="local-6989586621679040885"><a href="#local-6989586621679040885"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><a href="#local-6989586621679040885"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-1333"></a><span>    </span><span class="hs-pragma">{-# INLINE fail #-}</span><span>
</span><a name="line-1334"></a><span>
</span><a name="line-1335"></a><span class="hs-cpp">#if MIN_VERSION_base(4,9,0)</span><span>
</span><a name="line-1336"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fail</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">MonadFail</span><span> </span><a href="#local-6989586621679040875"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Fail</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">MonadFail</span><span> </span><span class="hs-special">(</span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-type">StateT</span></a><span> </span><a href="#local-6989586621679040876"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679040875"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1337"></a><span>    </span><a name="local-3458764513820541104"><span class="hs-identifier">fail</span></a><span> </span><a name="local-6989586621679040877"><a href="#local-6989586621679040877"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lens.Micro.html#StateT"><span class="hs-identifier hs-var">StateT</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Fail</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fail</span><span> </span><a href="#local-6989586621679040877"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-1338"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-1339"></a></pre></body></html>